!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).shexCore=e()}}(function(){return function(){return function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){return i(t[a][1][e]||e)},p,p.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}}()({1:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],2:[function(e,t,n){var r,i,s=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var c,p=[],l=!1,f=-1;function h(){l&&c&&(l=!1,c.length?p=c.concat(p):f=-1,p.length&&d())}function d(){if(!l){var e=u(h);l=!0;for(var t=p.length;t;){for(c=p,p=[];++f<t;)c&&c[f].run();f=-1,t=p.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new v(e,t)),1!==p.length||l||u(d)},v.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],3:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],4:[function(e,t,n){(function(t,r){var i=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(o(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,s=r.length,a=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),u=r[n];n<s;u=r[++n])v(u)||!S(u)?a+=" "+u:a+=" "+o(u);return a},n.deprecate=function(e,i){if(g(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return function(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}};var s,a={};function o(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(t)?r.showHidden=t:t&&n._extend(r,t),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),p(r,e,r.depth)}function u(e,t){var n=o.styles[t];return n?"["+o.colors[n][0]+"m"+e+"["+o.colors[n][1]+"m":e}function c(e,t){return e}function p(e,t,r){if(e.customInspect&&t&&w(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return y(i)||(i=p(e,i,r)),i}var s=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(m(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,t);if(s)return s;var a=Object.keys(t),o=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),b(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(w(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(b(t))return l(t)}var c,S="",O=!1,j=["{","}"];(h(t)&&(O=!0,j=["[","]"]),w(t))&&(S=" [Function"+(t.name?": "+t.name:"")+"]");return x(t)&&(S=" "+RegExp.prototype.toString.call(t)),E(t)&&(S=" "+Date.prototype.toUTCString.call(t)),b(t)&&(S=" "+l(t)),0!==a.length||O&&0!=t.length?r<0?x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=O?function(e,t,n,r,i){for(var s=[],a=0,o=t.length;a<o;++a)k(t,String(a))?s.push(f(e,t,n,r,String(a),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(f(e,t,n,r,i,!0))}),s}(e,t,r,o,a):a.map(function(n){return f(e,t,r,o,n,O)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,S,j)):j[0]+S+j[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,s){var a,o,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(o=e.stylize("[Setter]","special")),k(r,i)||(a="["+i+"]"),o||(e.seen.indexOf(u.value)<0?(o=v(n)?p(e,u.value,null):p(e,u.value,n-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),g(a)){if(s&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+o}function h(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function v(e){return null===e}function m(e){return"number"==typeof e}function y(e){return"string"==typeof e}function g(e){return void 0===e}function x(e){return S(e)&&"[object RegExp]"===O(e)}function S(e){return"object"==typeof e&&null!==e}function E(e){return S(e)&&"[object Date]"===O(e)}function b(e){return S(e)&&("[object Error]"===O(e)||e instanceof Error)}function w(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function j(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(g(s)&&(s=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(s)){var r=t.pid;a[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else a[e]=function(){};return a[e]},n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=h,n.isBoolean=d,n.isNull=v,n.isNullOrUndefined=function(e){return null==e},n.isNumber=m,n.isString=y,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=g,n.isRegExp=x,n.isObject=S,n.isDate=E,n.isError=b,n.isFunction=w,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!S(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:2,inherits:1}],5:[function(e,t,n){var r=function(){var e=/^[a-z][a-z0-9+.-]*:/i,t=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,n=/(?:^|\/)\.\.?(?:$|[\/#?])/;const r="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",i="http://www.w3.org/2001/XMLSchema#string";function s(e){if(!n.test(e))return e;for(var t="",r=e.length,i=-1,s=-1,a=0,o="/";i<r;){switch(o){case":":if(s<0&&"/"===e[++i]&&"/"===e[++i])for(;(s=i+1)<r&&"/"!==e[s];)i=s;break;case"?":case"#":i=r;break;case"/":if("."===e[i+1])switch(o=e[++i+1]){case"/":t+=e.substring(a,i-1),a=i+1;break;case void 0:case"?":case"#":return t+e.substring(a,i)+e.substr(i+1);case".":if(void 0===(o=e[++i+1])||"/"===o||"?"===o||"#"===o){if((a=(t+=e.substring(a,i-2)).lastIndexOf("/"))>=s&&(t=t.substr(0,a)),"/"!==o)return t+"/"+e.substr(i+1);a=i+1}}}o=e[++i]}return t+e.substring(a)}function a(e){switch(e.termType){case"NamedNode":return e.value;case"BlankNode":return"_:"+e.value;case"Literal":return'"'+e.value+'"'+(e.datatypeString===r?"@"+e.language:e.datatypeString===i?"":"^^"+e.datatypeString);default:throw Error("unknown RDFJS node type: "+JSON.stringify(e))}}function o(e,t){if(u(e))return t.namedNode(e);if(p(e))return t.blankNode(e.substr(2));if(c(e))return t.literal(l(e),h(e)||t.namedNode(f(e)));throw Error("Unknown internal term type: "+JSON.stringify(e))}function u(e){if("string"!=typeof e)return!1;if(0===e.length)return!0;var t=e[0];return'"'!==t&&"_"!==t}function c(e){return"string"==typeof e&&'"'===e[0]}function p(e){return"string"==typeof e&&"_:"===e.substr(0,2)}function l(e){var t=/^"([^]*)"/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]}function f(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]||(t[2]?r:i)}function h(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]?t[1].toLowerCase():""}var d=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,v=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,m={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};function y(e){var t=m[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}return{RdfLangString:r,XsdString:i,resolveRelativeIRI:function(n,r){if(e.test(r))return r;switch(r[0]){case void 0:return n;case"#":return n+r;case"?":return n.replace(/(?:\?.*)?$/,r);case"/":let e=n.match(t);return("/"===r[1]?e[1]:e[0])+s(r);default:return s(n.replace(/[^\/?]*(?:\?.*)?$/,"")+r)}},isIRI:u,isLiteral:c,isBlank:p,isDefaultGraph:function(e){return!e},inDefaultGraph:function(e){return!e.graph},getLiteralValue:l,getLiteralType:f,getLiteralLanguage:h,internalTerm:a,internalTriple:function(e){return{subject:a(e.subject),predicate:a(e.predicate),object:a(e.object)}},externalTerm:o,externalTriple:function(e,t){return{subject:o(e.subject,t),predicate:o(e.predicate,t),object:o(e.object,t)}},intermalTermToTurtle:function(e,t,n){if(u(e)){d.test(e)&&(e=e.replace(v,y));var r=Object.keys(n).find(t=>e.startsWith(n[t]));return r?r+e.substr(n[r].length):e.startsWith(t)?"<"+e.substr(t.length)+">":"<"+e+">"}if(p(e))return e;if(c(e)){var i=l(e),s=f(e),a=h(e);return d.test(i)&&(i=i.replace(v,y)),a?'"'+i+'"@'+a:s?'"'+i+'"^^'+this._encodeIriOrBlankNode(s):'"'+i+'"'}throw Error("Unknown internal term type: "+JSON.stringify(e))}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{}],6:[function(t,n,r){var i=function(){var n=t("./RdfTerm");const r=t("hierarchy-closure"),i={_namespace:"http://www.w3.org/ns/shex#"};["Schema","@context","imports","startActs","start","shapes","ShapeOr","ShapeAnd","shapeExprs","nodeKind","NodeConstraint","iri","bnode","nonliteral","literal","datatype","length","minlength","maxlength","pattern","flags","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits","values","ShapeNot","shapeExpr","Shape","virtual","closed","extra","expression","inherit","semActs","ShapeRef","reference","ShapeExternal","EachOf","OneOf","expressions","min","max","annotation","TripleConstraint","inverse","negated","predicate","valueExpr","Inclusion","include","Language","languageTag","IriStem","LiteralStem","LanguageStem","stem","IriStemRange","LiteralStemRange","LanguageStemRange","exclusion","Wildcard","SemAct","name","code","Annotation","object"].forEach(e=>{i[e]=i._namespace+e});const s={_namespace:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"};["type","first","rest","nil"].forEach(e=>{s[e]=s._namespace+e});const a={_namespace:"http://www.w3.org/2001/XMLSchema#"};["anyURI"].forEach(e=>{a[e]=a._namespace+e});const o={_namespace:"http://www.w3.org/2002/07/owl#"};["Thing"].forEach(e=>{o[e]=o._namespace+e});const u={};var c=-1;function p(e){e||(e={});for(var t,n=1,r=arguments.length;n<r&&(t=arguments[n]||{});n++)for(var i in t)e[i]=t[i];return e}function l(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}var f={SX:i,RDF:s,version:function(){return"0.5.0"},Visitor:function(){var e=this;var t={runtimeError:function(e){throw e},visitSchema:function(t){var n={type:"Schema"};return e._expect(t,"type","Schema"),this._maybeSet(t,n,"Schema",["prefixes","base","imports","startActs","start","shapes","productions"]),n},visitPrefixes:function(e){return void 0===e?void 0:(t=e,n=function(e){return e},r={},Object.keys(t).forEach(function(e){r[e]=n(t[e])}),r);var t,n,r},visitIRI:function(e){return e},visitImports:function(e){var t=this;return e.map(function(e){return t.visitIRI(e)})},visitStartActs:function(e){var t=this;return void 0===e?void 0:e.map(function(e){return t.visitSemAct(e)})},visitSemActs:function(e){var t=this;if(void 0!==e){var n=[];return Object.keys(e).forEach(function(r){n.push(t.visitSemAct(e[r],r))}),n}},visitSemAct:function(t,n){var r={type:"SemAct"};return e._expect(t,"type","SemAct"),this._maybeSet(t,r,"SemAct",["name","code"]),r},visitShapes:function(e){var t=this;if(void 0!==e){var n={};return Object.keys(e).forEach(function(r){n[r]=t.visitShapeExpr(e[r],r)}),n}},visitProductions:function(e){var t=this;if(void 0!==e){var n={};return Object.keys(e).forEach(function(r){n[r]=t.visitExpression(e[r],r)}),n}},visitShapeExpr:function(e,t){var n="Shape"===e.type?this.visitShape(e,t):"NodeConstraint"===e.type?this.visitNodeConstraint(e,t):"ShapeAnd"===e.type?this.visitShapeAnd(e,t):"ShapeOr"===e.type?this.visitShapeOr(e,t):"ShapeNot"===e.type?this.visitShapeNot(e,t):"ShapeRef"===e.type?this.visitShapeRef(e):"ShapeExternal"===e.type?this.visitShapeExternal(e):null;if(null===n)throw Error("unexpected shapeExpr type: "+e.type);return n},_visitShapeGroup:function(e,t){this._testUnknownAttributes(e,["id","shapeExprs"],e.type,this.visitShapeNot);var n=this,r={type:e.type};return"id"in e&&(r.id=e.id),r.shapeExprs=e.shapeExprs.map(function(e){return n.visitShapeExpr(e,t)}),r},visitShapeNot:function(e,t){this._testUnknownAttributes(e,["id","shapeExpr"],"ShapeNot",this.visitShapeNot);var n={type:e.type};return"id"in e&&(n.id=e.id),n.shapeExpr=this.visitShapeExpr(e.shapeExpr,t),n},visitShape:function(t,n){var r={type:"Shape"};return e._expect(t,"type","Shape"),this._maybeSet(t,r,"Shape",["id","closed","expression","extra","semActs","annotations"]),r},visitNodeConstraint:function(t,n){var r={type:"NodeConstraint"};return e._expect(t,"type","NodeConstraint"),this._maybeSet(t,r,"NodeConstraint",["id","nodeKind","datatype","pattern","flags","length","reference","minlength","maxlength","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits","values","annotations","semActs"]),r},visitShapeRef:function(e){return this._testUnknownAttributes(e,["reference"],"ShapeRef",this.visitShapeNot),{type:"ShapeRef",reference:e.reference}},visitShapeExternal:function(e){return this._testUnknownAttributes(e,["id"],"ShapeExternal",this.visitShapeNot),p("id"in e?{id:e.id}:{},{type:"ShapeExternal"})},_visitGroup:function(e,t){var n=this,r=Object.assign("id"in e?{id:null}:{},{type:e.type});return r.expressions=e.expressions.map(function(e){return n.visitExpression(e)}),this._maybeSet(e,r,"expr",["id","min","max","annotations","semActs"],["expressions"])},visitTripleConstraint:function(e){return this._maybeSet(e,Object.assign("id"in e?{id:null}:{},{type:"TripleConstraint"}),"TripleConstraint",["id","inverse","predicate","valueExpr","min","max","annotations","semActs"])},visitExpression:function(e){var t="TripleConstraint"===e.type?this.visitTripleConstraint(e):"OneOf"===e.type?this.visitOneOf(e):"EachOf"===e.type?this.visitEachOf(e):"Inclusion"===e.type?this.visitInclusion(e):null;if(null===t)throw Error("unexpected expression type: "+e.type);return t},visitValues:function(e){var t=this;return e.map(function(e){return l(e)||"Language"===e.type?e:t.visitStemRange(e)})},visitStemRange:function(t){var n=this;"type"in t||n.runtimeError(Error("expected "+JSON.stringify(t)+" to have a 'type' attribute."));var r,i=["IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];return-1===i.indexOf(t.type)&&n.runtimeError(Error("expected type attribute '"+t.type+"' to be in '"+i+"'.")),l(t)?(e._expect(t.stem,"type","Wildcard"),r={type:t.type,stem:{type:"Wildcard"}}):r={type:t.type,stem:t.stem},t.exclusions&&(r.exclusions=t.exclusions.map(function(e){return n.visitExclusion(e)})),r},visitExclusion:function(e){if(l(e))return e;"type"in e||_Visitor.runtimeError(Error("expected "+JSON.stringify(e)+" to have a 'type' attribute."));var t=["IriStem","LiteralStem","LanguageStem"];return-1===t.indexOf(e.type)&&_Visitor.runtimeError(Error("expected type attribute '"+e.type+"' to be in '"+t+"'.")),{type:e.type,stem:e.stem}},visitInclusion:function(t){var n={type:"Inclusion"};return e._expect(t,"type","Inclusion"),this._maybeSet(t,n,"Inclusion",["include"]),n},_maybeSet:function(e,t,n,r,i){var s=this;return this._testUnknownAttributes(e,i?r.concat(i):r,n,this._maybeSet),r.forEach(function(n){var r="visit"+n.charAt(0).toUpperCase()+n.slice(1);if(n in e){var i=s[r];if("function"!=typeof i)throw Error(r+" not found in Visitor");var a=i.call(s,e[n]);void 0!==a&&(t[n]=a)}}),t},_visitValue:function(e){return e},_visitList:function(e){return e.slice()},_testUnknownAttributes:function(e,t,n,r){var i=Object.keys(e).reduce(function(e,n){return"type"!==n&&-1===t.indexOf(n)?e.concat(n):e},[]);if(i.length>0){var s=Error("unknown propert"+(i.length>1?"ies":"y")+": "+i.map(function(e){return'"'+e+'"'}).join(",")+" in "+n+": "+JSON.stringify(e));throw Error.captureStackTrace(s,r),s}}};return t.visitBase=t.visitStart=t.visitVirtual=t.visitClosed=t._visitValue,t.visitInherit=t.visitExtra=t.visitAnnotations=t._visitList,t.visitInverse=t.visitPredicate=t._visitValue,t.visitName=t.visitId=t.visitCode=t.visitMin=t.visitMax=t._visitValue,t.visitType=t.visitNodeKind=t.visitDatatype=t.visitPattern=t.visitFlags=t.visitLength=t.visitMinlength=t.visitMaxlength=t.visitMininclusive=t.visitMinexclusive=t.visitMaxinclusive=t.visitMaxexclusive=t.visitTotaldigits=t.visitFractiondigits=t._visitValue,t.visitOneOf=t.visitEachOf=t._visitGroup,t.visitShapeAnd=t.visitShapeOr=t._visitShapeGroup,t.visitInclude=t._visitValue,t.visitValueExpr=t.visitShapeExpr,t},ShExJVisitor:function(e){var t=f.Visitor(),n=t.visitShapeExpr,r=t.visitShape,i=t.visitExpression;return t.visitShapeExpr=t.visitValueExpr=function(e,t){return"string"==typeof e?{type:"ShapeRef",reference:e}:n.call(this,e,t)},t.visitShape=function(e,t){var n=r.call(this,e,t);return"extra"in e&&n.extra.sort(),n},t.visitExpression=function(t){var n="string"==typeof t?{type:"Inclusion",include:t}:i.call(this,t);return"object"==typeof t&&"id"in t&&(e[t.id]=n),n},t},ShExJtoAS:function(e){var t=this;delete e["@context"];var n={};if("start"in e){var r=t.ShExJVisitor(n);e.start=r.visitShapeExpr(e.start)}if("shapes"in e){var i={};e.shapes.forEach(e=>{var r=e.id;delete e.id;var s=t.ShExJVisitor(n);i[r]=s.visitShapeExpr(e)}),e.shapes=i}return Object.keys(n).length>0&&(e.productions=n),e},AStoShExJ:function(e,t){t||(delete e.prefixes,delete e.base),delete e.productions,e["@context"]="http://www.w3.org/ns/shex.jsonld";var n=f.Visitor();if(n.visitShapeRef=function(e){return e.reference},n.visitInclusion=function(e){return e.include},"start"in e&&(e.start=n.visitShapeExpr(e.start)),"shapes"in e){var r=[];for(var i in e.shapes)r.push(Object.assign({id:i},n.visitShapeExpr(e.shapes[i])));e.shapes=r}return e},ShExRVisitor:function(e){var t=f.Visitor(),r={},i=t.visitShapeExpr,s=(t.visitValueExpr,t.visitExpression);return t.keepShapeExpr=i,t.visitShapeExpr=t.visitValueExpr=function(t,n){if("string"==typeof t)return t;if("id"in t){if(-1!==e.indexOf(t.id)||1===Object.keys(t).length)return t.id;delete t.id}return i.call(this,t,n)},t.visitExpression=function(e){if("string"==typeof e)return e;if("id"in e&&e.id in r)return r[e.id].refCount++,e.id;var t=s.call(this,e);return r[e.id]={refCount:1,expr:t},t},t.cleanIds=function(){for(var e in r){var t=r[e];1===t.refCount&&n.isBlank(t.expr.id)&&delete t.expr.id}},t},ShExRtoShExJ:function(e){var t=[];"shapes"in e&&(t=t.concat(e.shapes.map(e=>e.id)));var n=this.ShExRVisitor(t);return"start"in e&&(e.start=n.visitShapeExpr(e.start)),"shapes"in e&&(e.shapes=e.shapes.map(e=>n.keepShapeExpr(e))),n.cleanIds(),e},valGrep:function(e,t,n){var r=[];for(var i in e){var s=e[i];"object"==typeof s&&("type"in s&&s.type===t&&r.push(n(s)),r.push.apply(r,this.valGrep(s,t,n)))}return r},n3jsToTurtle:function(e){return this.valGrep(e,"TestedTriple",function(e){return["subject","predicate","object"].map(r=>"object"==typeof(t=e[r])?'"'+t.value+'"'+("type"in t?"^^<"+t.type+">":"language"in t?"@"+t.language:""):n.isIRI(t)?"<"+t+">":n.isBlank(t)?t:"???").join(" ")+" .";var t})},valToN3js:function(e){return this.valGrep(e,"TestedTriple",function(e){var t=JSON.parse(JSON.stringify(e));return"object"==typeof e.object&&(t.object='"'+e.object.value+'"'+("type"in e.object?"^^"+e.object.type:"language"in e.object?"@"+e.object.language:"")),t})},n3jsToTurtle:function(e){return e.map(function(e){return["subject","predicate","object"].map(t=>(function(e){if(n.isIRI(e))return"<"+e+">";if(n.isBlank(e))return e;var t=n.getLiteralType(e);return t&&"http://www.w3.org/2001/XMLSchema#string"!==t?'"'+n.getLiteralValue(e)+'"^^<'+t+">":e})(e[t])).join(" ")+" ."})},canonicalize:function(e,t){var n=JSON.parse(JSON.stringify(e));delete n.prefixes,delete n.base;var r=f.Visitor(),i=[],s=r.visitInclusion,a=r.visitExpression;return r.visitInclusion=function(t){return-1===i.indexOf(t.include)&&"productions"in e&&t.include in e.productions?(i.push(t.include),a.call(r,e.productions[t.include])):s.call(r,t)},r.visitExpression=function(t){return"id"in t?-1===i.indexOf(t.id)?(i.push(t.id),a.call(r,e.productions[t.id])):{type:"Inclusion",include:t.id}:a.call(r,t)},t&&(r.visitIRI=function(e){return e.replace(t,"")},"imports"in n&&(n.imports=r.visitImports(n.imports))),"shapes"in n&&Object.keys(n.shapes).sort().forEach(e=>{"extra"in n.shapes[e]&&n.shapes[e].extra.sort(),n.shapes[e]=r.visitShapeExpr(n.shapes[e])}),n},BiDiClosure:function(){return{needs:{},neededBy:{},inCycle:[],test:function(){function e(e,t){var n=JSON.stringify(e),r=JSON.stringify(t);if(n!==r)throw Error(n+" !== "+r)}this.add(2,3),e(this.needs,{2:[3]}),e(this.neededBy,{3:[2]}),this.add(1,2),e(this.needs,{1:[2,3],2:[3]}),e(this.neededBy,{3:[2,1],2:[1]}),this.add(1,3),e(this.needs,{1:[2,3],2:[3]}),e(this.neededBy,{3:[2,1],2:[1]}),this.add(3,4),e(this.needs,{1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{3:[2,1],2:[1],4:[3,2,1]}),this.add(6,7),e(this.needs,{6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6],3:[2,1],2:[1],4:[3,2,1]}),this.add(5,6),e(this.needs,{5:[6,7],6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],3:[2,1],2:[1],4:[3,2,1]}),this.add(5,7),e(this.needs,{5:[6,7],6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],3:[2,1],2:[1],4:[3,2,1]}),this.add(7,8),e(this.needs,{5:[6,7,8],6:[7,8],7:[8],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],8:[7,6,5],3:[2,1],2:[1],4:[3,2,1]}),this.add(4,5),e(this.needs,{1:[2,3,4,5,6,7,8],2:[3,4,5,6,7,8],3:[4,5,6,7,8],4:[5,6,7,8],5:[6,7,8],6:[7,8],7:[8]}),e(this.neededBy,{2:[1],3:[2,1],4:[3,2,1],5:[4,3,2,1],6:[5,4,3,2,1],7:[6,5,4,3,2,1],8:[7,6,5,4,3,2,1]})},add:function(e,t,n){var r=this;e in r.needs||(r.needs[e]=[]),t in r.neededBy||(r.neededBy[t]=[]),r.needs[e]=r.needs[e].concat([t],r.needs[t]).filter(function(e,t,n){return void 0!==e&&n.indexOf(e)===t}),r.neededBy[t]=r.neededBy[t].concat([e],r.neededBy[e]).filter(function(e,t,n){return void 0!==e&&n.indexOf(e)===t}),e in this.neededBy&&this.neededBy[e].forEach(function(e){r.needs[e]=r.needs[e].concat([t],r.needs[t]).filter(function(e,t,n){return void 0!==e&&n.indexOf(e)===t})}),t in this.needs&&this.needs[t].forEach(function(t){r.neededBy[t]=r.neededBy[t].concat([e],r.neededBy[e]).filter(function(e,t,n){return void 0!==e&&n.indexOf(e)===t})}),-1!==r.needs[e].indexOf(e)&&(r.inCycle=r.inCycle.concat(r.needs[e]))},trim:function(){function e(e){for(var t=e.length-1;t>-1;--t)e.indexOf(e[t])<t&&e.splice(t,t+1)}for(k in this.needs)e(this.needs[k]);for(k in this.neededBy)e(this.neededBy[k])},foundIn:{},addIn:function(e,t){this.foundIn[e]=t}}},nestShapes:function(e,t={}){var n=this;"no"in t||(t.no=!1);let r=Object.keys(e.shapes||[]),i={};r.forEach(t=>{let r=e.shapes[t];if(a(t,null),"Shape"===(r=n.skipDecl(r)).type)"extends"in r&&r.extends.forEach(e=>a(e,r)),"expression"in r&&(n.simpleTripleConstraints(r)||[]).forEach(e=>{a(n.getValueType(e.valueExpr,!0),{type:"tc",shapeLabel:t,tc:e})});else if("NodeConstraint"!==r.type)throw Error("nestShapes currently only supports Shapes and NodeConstraints")});let s=Object.keys(i).filter(t=>1===i[t].length&&"tc"===i[t][0].type&&"Shape"===n.skipDecl(e.shapes[t]).type).reduce((e,t)=>(e[t]={referrer:i[t][0].shapeLabel,predicate:i[t][0].tc.predicate},e),{});if(!t.no){let n={};if(t.rename){"transform"in t||(t.transform=function(){let e=r.reduce((e,t,n)=>(e[t]="_:transformed"+n,e),{});return function(t,n){return e[t]}}()),Object.keys(s).forEach(a=>{let o=e.shapes[a],u=t.transform(a,o);if(n[a]=u,r[r.indexOf(a)]=u,s[u]=s[a],s[u].was=a,delete s[a],e.shapes[u]=e.shapes[a],delete e.shapes[a],1!==i[a].length)throw Error("assertion: "+a+" doesn't have one reference: ["+i[a]+"]");let c=i[a][0];if("tc"!==c.type)throw"Shape"===c.type?Error("assertion: rename not implemented for Shape: "+c):Error("assertion: "+c.type+" not TripleConstraint or Shape");if("ShapeRef"!==c.tc.valueExpr.type)throw Error("assertion: rename not implemented for TripleConstraint expr: "+c.tc.valueExpr);c.tc.valueExpr.reference=u}),Object.keys(s).forEach(e=>{let t=s[e];t.referrer in n&&(t.newReferrer=n[t.referrer])});let a={};r.forEach(t=>a[t]=e.shapes[t]),e.shapes=a}else Object.keys(s).forEach(t=>{i[t][0].tc.valueExpr=e.shapes[t].shapeExpr,delete e.shapes[t]})}return s;function a(e,t){e in i||(i[e]=[]),t&&i[e].push(t)}},getPredicateUsage:function(e,t={}){var n=this;let i=r.create();Object.keys(e.shapes).forEach(t=>{let r=n.skipDecl(e.shapes[t]);"Shape"===r.type&&(r.extends||[]).forEach(e=>i.add(e,t))}),Object.keys(e.shapes).forEach(e=>{e in i.parents||(i.parents[e]=[])});let s={};return Object.keys(e.shapes).forEach(r=>{let a=n.skipDecl(e.shapes[r]);if("Shape"===a.type){(n.simpleTripleConstraints(a)||[]).forEach(e=>{let a=n.getValueType(e.valueExpr);if(e.predicate in s){s[e.predicate].uses.push(r);let n=s[e.predicate].commonType;if("object"==typeof n||null===n)t[e.predicate].references.push({shapeLabel:r,newType:a});else if("object"==typeof a)s[e.predicate].commonType=null,t[e.predicate]={shapeLabel:r,predicate:e.predicate,curType:n,newType:a,references:[]};else if(n===a);else if(-1!==i.parents[n].indexOf(a))s[e.predicate].polymorphic=!0;else{let o=i.parents[a].indexOf(n);if(-1===o){let o=i.parents[n].filter(e=>-1!==i.parents[a].indexOf(e));0===o.length?(t[e.predicate]={shapeLabel:r,predicate:e.predicate,curType:n,newType:a,references:[]},s[e.predicate].commonType=null):(s[e.predicate].commonType=o[0],s[e.predicate].polymorphic=!0)}else s[e.predicate].commonType=i.parents[a][o],s[e.predicate].polymorphic=!0}}else s[e.predicate]={uses:[r],commonType:a,polymorphic:!1},"object"==typeof a&&(t[e.predicate]={shapeLabel:r,predicate:e.predicate,newType:a,references:[]})})}}),s},simpleTripleConstraints:function(e){if(!("expression"in e))return[];if("TripleConstraint"===e.expression.type)return[e.expression];if("EachOf"===e.expression.type&&!e.expression.expressions.find(e=>"TripleConstraint"!==e.type))return e.expression.expressions;throw Error("can't (yet) express "+JSON.stringify(e))},skipDecl:function(e){return"ShapeDecl"===e.type?e.shapeExpr:e},getValueType:function(e){return"string"==typeof e?e:e.reference?e.reference:"iri"===e.nodeKind?o.Thing:e.datatype?e.datatype:e},getDependencies:function(e,t){return t=t||this.BiDiClosure(),Object.keys(e.shapes||[]).forEach(function(n){function r(e,i){if("ShapeOr"===e.type||"ShapeAnd"===e.type)e.shapeExprs.forEach(function(e){r(e,i)});else if("ShapeNot"===e.type)r(e.shapeExpr,1^i);else if("Shape"===e.type)!function(e,i){e.inherit&&e.inherit.length>0&&e.inherit.forEach(function(e){t.add(n,e)});e.expression&&function e(i,s){function a(t,n){t.forEach(function(t){e(t,n)})}"id"in i&&t.addIn(i.id,n);if("TripleConstraint"===i.type)!function(e,i){e.valueExpr&&r(e.valueExpr,i);if(i&&-1!==t.inCycle.indexOf(n))throw Error("Structural error: "+n+" appears in negated cycle")}(i,s);else if("OneOf"===i.type||"EachOf"===i.type)!function a(e,i){e.forEach(function(e){!function e(i,s){function a(t,n){t.forEach(function(t){e(t,n)})}"id"in i&&t.addIn(i.id,n);if("TripleConstraint"===i.type)!function(e,i){e.valueExpr&&r(e.valueExpr,i);if(i&&-1!==t.inCycle.indexOf(n))throw Error("Structural error: "+n+" appears in negated cycle")}(i,s);else if("OneOf"===i.type||"EachOf"===i.type)a(i.expressions);else{if("Inclusion"!==i.type)throw Error("expected {TripleConstraint,OneOf,EachOf,Inclusion} in "+i);t.add(n,i.include)}}(e,i)})}(i.expressions);else{if("Inclusion"!==i.type)throw Error("expected {TripleConstraint,OneOf,EachOf,Inclusion} in "+i);t.add(n,i.include)}}(e.expression,i)}(e,i);else if("NodeConstraint"===e.type);else if("ShapeRef"===e.type)t.add(n,e.reference);else if("ShapeExternal"!==e.type)throw Error("expected Shape{And,Or,Ref,External} or NodeConstraint in "+util.inspect(e))}r(e.shapes[n],0)}),t},partition:function(e,t,n,r){t=t instanceof Array?t:[t],n=n||this.getDependencies(e),r=r||function(e,t){throw new Error("Error: can't find shape "+(t?t+" dependency "+e:e))};var i={};for(var s in e)i[s]="shapes"===s?{}:e[s];return t.forEach(function(t){t in e.shapes?(i.shapes[t]=e.shapes[t],t in n.needs&&n.needs[t].forEach(function(s){if(s in e.shapes)i.shapes[s]=e.shapes[s];else if(s in e.productions){var a=n.foundIn[s];i.shapes[a]=e.shapes[a],i.productions[s]=e.productions[s]}else r(s,t)})):r(t)}),i},flatten:function(e,t,n){return this.Visitor().visitSchema(e)},emptySchema:function(){return{type:"Schema"}},merge:function(e,t,n,r){var i,s=r?e:this.emptySchema();return"productions"in e&&(s.productions=e.productions),"productions"in t&&("productions"in e&&!n||(s.productions=t.productions)),"base"in e&&(s.base=e.base),"base"in t&&("base"in e&&!n||(s.base=t.base)),i="prefixes",Object.keys(e[i]||{}).forEach(function(t){i in s||(s[i]={}),s[i][t]=e[i][t]}),Object.keys(t[i]||{}).forEach(function(r){i in e&&r in e[i]&&!n||(i in s||(s[i]={}),s[i][r]=t[i][r])}),"imports"in t&&("imports"in e&&!n||(s.imports=t.imports)),"startActs"in e&&(s.startActs=e.startActs),"startActs"in t&&("startActs"in e&&!n||(s.startActs=t.startActs)),"start"in e&&(s.start=e.start),"start"in t&&("start"in e&&!n||(s.start=t.start)),Object.keys(e.shapes||{}).forEach(function(t){"shapes"in s||(s.shapes={}),s.shapes[t]=e.shapes[t]}),Object.keys(t.shapes||{}).forEach(function(r){"shapes"in e&&r in e.shapes&&!n||("shapes"in s||(s.shapes={}),s.shapes[r]=t.shapes[r])}),s},absolutizeResults:function(e,t){function r(e,r){-1!==["shape","reference","node","subject","predicate","object"].indexOf(e)&&n.isIRI(r[e])&&(r[e]=n.resolveRelativeIRI(t,r[e]))}return function e(t){Object.keys(t).forEach(function(n){"object"==typeof t[n]&&e(t[n]),r&&r(n,t)})}(e),e},validateSchema:function(e){var t=this.Visitor(),n=currentExtra=null,i=!1,s=!1,a=t.visitShape,o=r.create(),u=r.create();t.visitShape=function(e,n){var r=currentExtra;currentExtra=e.extra;var i=a.call(t,e,n);return currentExtra=r,i};var c=t.visitShapeNot;t.visitShapeNot=function(e,n){var r=i;i^=!0;var s=c.call(t,e,n);return i=r,s};var p=t.visitTripleConstraint;t.visitTripleConstraint=function(e){var n=i;currentExtra&&-1!==currentExtra.indexOf(e.predicate)&&(i^=!0),s=!0;var r=p.call(t,e);return s=!1,i=n,r};var l=t.visitShapeRef;t.visitShapeRef=function(r){if(!(r.reference in e.shapes))throw Error("Structural error: reference to "+JSON.stringify(r)+" not found in schema shape expressions:\n"+d(e.shapes)+".");if(!s&&r.reference===n)throw Error("Structural error: circular reference to "+n+".");return(i?o:u).add(n,r.reference),l.call(t,r)};var f=t.visitInclusion;t.visitInclusion=function(n){if(!("productions"in e&&e.productions[n.include]))throw Error("Structural error: included shape "+n.include+" not found in schema triple expressions:\n"+d(e.productions)+".");return f.call(t,n)},Object.keys(e.shapes||[]).forEach(function(r){n=r,t.visitShapeExpr(e.shapes[r],r)});let h=Object.keys(o.children).filter(e=>o.children[e].filter(t=>t in o.children&&-1!==o.children[t].indexOf(e)||t in u.children&&-1!==u.children[t].indexOf(e)).length>0);if(h.length)throw Error("Structural error: circular negative dependencies on "+h.join(",")+".");function d(e){return e?Object.keys(e).map(e=>"_:"===e.substr(0,2)?e:"<"+e+">").join("\n        "):"- none defined -"}},isWellDefined:function(e){return this.validateSchema(e),e},walkVal:function(e,t){var n=this;if("NodeTest"===e.type)return null;if("ShapeTest"===e.type)return"solution"in e?n.walkVal(e.solution,t):null;if("ShapeOrResults"===e.type)return n.walkVal(e.solution,t);if("EachOfSolutions"===e.type||"OneOfSolutions"===e.type)return e.solutions.reduce((e,r)=>(r.expressions.forEach(r=>{var i=n.walkVal(r,t);i&&Object.keys(i).forEach(t=>{e[t]=t in e?e[t].concat(i[t]):i[t]})}),e),{});if("OneOfSolutions"===e.type)return e.solutions.reduce((e,r)=>(Object.assign(e,n.walkVal(r,t)),e),{});if("TripleConstraintSolutions"===e.type){if("solutions"in e){var r={},i=[];return r[e.predicate]=i,e.solutions.forEach(e=>{var r=[];if(function e(r){if(!r)return!1;if(r.node===s.nil)return!0;if("solution"in r&&"solutions"in r.solution&&1===r.solution.solutions.length&&"expressions"in r.solution.solutions[0]&&2===r.solution.solutions[0].expressions.length&&"predicate"in r.solution.solutions[0].expressions[0]&&r.solution.solutions[0].expressions[0].predicate===s.first&&r.solution.solutions[0].expressions[1].predicate===s.rest){var a=r.solution.solutions[0].expressions,o=a[0],u=a[1].solutions[0],c=o.solutions[0],p=t(c);if("referenced"in c){var l=n.walkVal(c.referenced,t);l&&(p.nested=l)}return i.push(p),u.object===s.nil||e(u.referenced)}}(e.referenced))i=i.concat(r);else{var a=t(e);if("referenced"in e){var o=n.walkVal(e.referenced,t);o&&(a.nested=o)}i.push(a)}}),i.length?r:null}return null}if("Recursion"===e.type)return null;throw Error("unknown shapeExpression type in "+JSON.stringify(e))},valToValues:function(e){return this.walkVal(e,function(e){return{ldterm:e.object}})},valToExtension:function(e,t){return function e(n){var r=[],i={};function s(e){if(null===i)return e;if(e.constructor===Array)return i=null,e;for(a in e){if(a in i)return i=null,e;i[a]=e[a]}return e}for(var a in n)if("extensions"===a)n[a]&&r.push(s(n[a][t]));else if("nested"===a){var o=e(n[a]);o.constructor===Array?o.forEach(s):s(o),r=r.concat(o)}else r.push(s(e(n[a])));return 1===r.length?r[0]:i||r}(this.walkVal(e,function(e){return{extensions:e.extensions}}))},valuesToSchema:function(e){var t=e;if(e[s.type][0].ldterm===i.Schema){var n={"@context":"http://www.w3.org/ns/shex.jsonld",type:"Schema"};i.startActs in t&&(n.startActs=t[i.startActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),i.imports in t&&(n.imports=t[i.imports].map(e=>e.ldterm)),e[i.start]&&(n.start=p({id:e[i.start][0].ldterm},o(e[i.start][0].nested)));var r=e[i.shapes];return r&&(n.shapes=r.map(e=>p({id:e.ldterm},o(e.nested)))),n}throw Error("unknown schema type in "+JSON.stringify(e));function a(e,t,n){var r=e[s.type][0].ldterm.substr(i._namespace.length),a=t[r];if(!a)return u;if(a.nary)return(o={type:r})[a.prop]=e[i[a.prop]].map(e=>c(e)),o;var o={type:r};return a.prop&&(o[a.prop]=c(e[i[a.prop]][0])),o;function c(e){return a.expr&&"nested"in e?p({id:e.ldterm},n(e.nested)):e.ldterm}}function o(e){if((n=a(e,{ShapeAnd:{nary:!0,expr:!0,prop:"shapeExprs"},ShapeOr:{nary:!0,expr:!0,prop:"shapeExprs"},ShapeNot:{nary:!1,expr:!0,prop:"shapeExpr"},ShapeRef:{nary:!1,expr:!1,prop:"reference"},ShapeExternal:{nary:!1,expr:!1,prop:null}},o))!==u)return n;var t=e[s.type][0].ldterm;if(t===i.Shape){var n={type:"Shape"};return["closed"].forEach(t=>{i[t]in e&&(n[t]=!!e[i[t]][0].ldterm.value)}),i.extra in e&&(n.extra=e[i.extra].map(e=>e.ldterm)),i.expression in e&&(n.expression="nested"in e[i.expression][0]?p({id:e[i.expression][0].ldterm},l(e[i.expression][0].nested)):e[i.expression][0].ldterm),i.annotation in e&&(n.annotations=e[i.annotation].map(e=>({type:"Annotation",predicate:e.nested[i.predicate][0].ldterm,object:e.nested[i.object][0].ldterm}))),i.semActs in e&&(n.semActs=e[i.semActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),n}if(t===i.NodeConstraint){n={type:"NodeConstraint"};return i.values in e&&(n.values=e[i.values].map(e=>(function e(t,n){if("nested"in t){var r=t.nested[s.type][0].ldterm;if(-1!==[i.IriStem,i.LiteralStem,i.LanguageStem].indexOf(r)){var a=t.nested[i.stem][0].ldterm.value;return{type:r.substr(i._namespace.length),stem:a}}if(-1!==[i.Language].indexOf(r))return{type:"Language",languageTag:t.nested[i.languageTag][0].ldterm.value};if(-1!==[i.IriStemRange,i.LiteralStemRange,i.LanguageStemRange].indexOf(r)){var o=t.nested[i.stem][0],u=o;"object"==typeof o&&("object"==typeof o.ldterm?u=o.ldterm:o.ldterm.startsWith("_:")&&(u={type:"Wildcard"}));var c={type:r.substr(i._namespace.length),stem:"Wildcard"!==u.type?u.value:u};return i.exclusion in t.nested&&(c.exclusions=t.nested[i.exclusion].map(t=>e(t,r!==i.IriStemRange))),c}throw Error("unknown objectValue type in "+JSON.stringify(t))}return n?t.ldterm.value:t.ldterm})(e))),i.nodeKind in e&&(n.nodeKind=e[i.nodeKind][0].ldterm.substr(i._namespace.length)),["length","minlength","maxlength","mininclusive","maxinclusive","minexclusive","maxexclusive","totaldigits","fractiondigits"].forEach(t=>{i[t]in e&&(n[t]=parseFloat(e[i[t]][0].ldterm.value))}),i.pattern in e&&(n.pattern=e[i.pattern][0].ldterm.value),i.flags in e&&(n.flags=e[i.flags][0].ldterm.value),i.datatype in e&&(n.datatype=e[i.datatype][0].ldterm),n}throw Error("unknown shapeExpr type in "+JSON.stringify(e))}function l(e){if((t=a(e,{EachOf:{nary:!0,expr:!0,prop:"expressions"},OneOf:{nary:!0,expr:!0,prop:"expressions"},Inclusion:{nary:!1,expr:!1,prop:"include"}},l))!==u)return f(e,t),t;if(e[s.type][0].ldterm===i.TripleConstraint){var t={type:"TripleConstraint",predicate:e[i.predicate][0].ldterm};return["inverse"].forEach(n=>{i[n]in e&&(t[n]=!!e[i[n]][0].ldterm.value)}),i.valueExpr in e&&(t.valueExpr=p({id:e[i.valueExpr][0].ldterm},"nested"in e[i.valueExpr][0]?o(e[i.valueExpr][0].nested):{})),f(e,t),t}throw Error("unknown tripleExpr type in "+JSON.stringify(e))}function f(e,t){return i.min in e&&(t.min=parseInt(e[i.min][0].ldterm.value)),i.max in e&&(t.max=parseInt(e[i.max][0].ldterm.value),isNaN(t.max)&&(t.max=c)),i.annotation in e&&(t.annotations=e[i.annotation].map(e=>({type:"Annotation",predicate:e.nested[i.predicate][0].ldterm,object:e.nested[i.object][0].ldterm}))),i.semActs in e&&(t.semActs=e[i.semActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),t}},valToSimple:function(e){var t,n=this;function r(e){return e.reduce((e,t)=>(Object.keys(t).forEach(n=>{e[n]=n in e?Array.from(new Set(e[n].concat(t[n]))):t[n]}),e),{})}if("TripleConstraintSolutions"===e.type)return"solutions"in e?e.solutions.reduce((e,t)=>{if(!("referenced"in t))return{};var i={};return function e(t){if(!t)return!1;if(t.node===s.nil)return!0;if("solution"in t&&"solutions"in t.solution&&1===t.solution.solutions.length&&"expressions"in t.solution.solutions[0]&&2===t.solution.solutions[0].expressions.length&&"predicate"in t.solution.solutions[0].expressions[0]&&t.solution.solutions[0].expressions[0].predicate===s.first&&t.solution.solutions[0].expressions[1].predicate===s.rest){var a=t.solution.solutions[0].expressions,o=a[0],u=a[1].solutions[0],c=o.solutions[0],p={ldterm:c.object};if("referenced"in c){var l=n.valToSimple(c.referenced);l&&(p.nested=l)}return i=r(i),u.object===s.nil||e(u.referenced)}}(t.referenced)?r(e):r(e,n.valToSimple(t.referenced))},[]):[];if(-1!==["TripleConstraintSolutions"].indexOf(e.type))return{};if("NodeTest"===e.type)return(t={})[h(e.node)]=[e.shape],t;if("ShapeTest"===e.type)return(t={})[h(e.node)]=[e.shape],"solution"in e?r([t].concat(n.valToSimple(e.solution))):t;if("Recursion"===e.type)return{};if("solutions"in e)return r(e.solutions.map(e=>n.valToSimple(e)));if("expressions"in e)return r(e.expressions.map(e=>n.valToSimple(e)));throw Error("unknown shapeExpression type in "+JSON.stringify(e))},simpleToShapeMap:function(e){return Object.keys(e).reduce((t,n)=>(e[n].forEach(e=>{t.push({node:n,shape:e})}),t),[])},absolutizeShapeMap:function(e,t){return e.map(e=>Object.assign(e,{node:n.resolveRelativeIRI(t,e.node),shape:n.resolveRelativeIRI(t,e.shape)}))},errsToSimple:function(n,r,i){var s=this;if("FailureList"===n.type)return n.errors.reduce((e,t)=>e.concat(s.errsToSimple(t)),[]);if("Failure"===n.type)return["validating "+n.node+" as "+n.shape+":"].concat(function e(t){return t.reduce(function(t,n){var r=Object.keys(n);return t.concat(1===r.length&&"errors"===r[0]?e(n.errors):n)},[])}(n.errors).reduce((e,t)=>{var n=s.errsToSimple(t).map(e=>"  "+e);return e.length>0?e.concat(["  OR"]).concat(n):n.map(e=>"  "+e)},[]));if("TypeMismatch"===n.type){var a=n.errors.constructor===Array?n.errors.reduce((e,t)=>e.concat(("string"==typeof t?[t]:s.errsToSimple(t)).map(e=>"  "+e)),[]):"  "+("string"==typeof e?[n.errors]:s.errsToSimple(n.errors));return["validating "+h(n.triple.object)+":"].concat(a)}if("ShapeAndFailure"===n.type)return n.errors.constructor===Array?n.errors.reduce((e,t)=>e.concat(("string"==typeof t?[t]:s.errsToSimple(t)).map(e=>"  "+e)),[]):"  "+("string"==typeof e?[n.errors]:s.errsToSimple(n.errors));if("ShapeOrFailure"===n.type)return n.errors.constructor===Array?n.errors.reduce((e,t)=>e.concat(" OR "+("string"==typeof t?[t]:s.errsToSimple(t))),[]):" OR "+("string"==typeof e?[n.errors]:s.errsToSimple(n.errors));if("ShapeNotFailure"===n.type)return["Node "+n.errors.node+" expected to NOT pass "+n.errors.shape];if("ExcessTripleViolation"===n.type)return["validating "+h(n.triple.object)+": exceeds cardinality"];if("ClosedShapeViolation"===n.type)return["ClosedShapeError: unexpected: {"].concat(n.unexpectedTriples.map(e=>"  "+e.subject+" "+e.predicate+" "+h(e.object)+" .")).concat(["}"]);if("NodeConstraintViolation"===n.type){var o,u=t("../lib/ShExWriter")();return u._write(u._writeNodeConstraint(n.shapeExpr).join("")),u.end((e,t)=>{o=t}),["NodeConstraintError: expected to match "+o]}if("MissingProperty"===n.type)return["Missing property: "+n.property];if("NegatedProperty"===n.type)return["Unexpected property: "+n.property];if(n.constructor===Array)return n.reduce((e,t)=>{var n=s.errsToSimple(t).map(e=>"  "+e);return e.length?e.concat(["AND"]).concat(n):n},[]);throw Error("unknown shapeExpression type in "+JSON.stringify(n))},resolveRelativeIRI:n.resolveRelativeIRI,resolvePrefixedIRI:function(e,t){var n=e.indexOf(":");if(-1===n)return null;var r=t[e.substr(0,n)];return void 0===r?null:r+e.substr(n+1)},parsePassedNode:function(e,t,r,i,s){if(void 0===e||0===e.length)return i&&i(t.base)?t.base:r?r():this.NotSupplied;if("_"===e[0]&&":"===e[1])return e;if('"'===e[0]){var a=e.match(/^"((?:[^"\\]|\\")*)"(?:@(.+)|\^\^(?:<(.*)>|([^:]*):(.*)))?$/);if(!a)throw Error("malformed literal: "+e);var o=a[1],u=a[2],c=a[3],p=a[4],l=a[5],f='"'+o+'"';if(void 0!==u)return f+"@"+u;if(void 0!==p){if(!(p in t.prefixes))throw Error("error parsing node "+e+' no prefix for "'+p+'"');return f+"^^"+t.prefixes[p]+l}return void 0!==c?f+"^^"+n.resolveRelativeIRI(t.base,c):f}if(!t)return i(e)?e:this.UnknownIRI;var h="<"===e[0]&&">"===e[e.length-1];h&&(e=e.substr(1,e.length-2));var d=n.resolveRelativeIRI(t.base||"",e);if(i(d))return d;if(!h){var v=this.resolvePrefixedIRI(e,t.prefixes);if(null!==v&&i(v))return v}return s?s(d):this.UnknownIRI},executeQueryPromise:function(e,t){var n=t+"?query="+encodeURIComponent(e);return fetch(n,{headers:{Accept:"application/sparql-results+json"}}).then(e=>e.json()).then(e=>{var t=e.head.vars;return e.results.bindings.map(e=>t.map(t=>{var n=e[t];switch(n.type){case"uri":return n.value;case"bnode":return"_:"+n.value;case"literal":var r=n.datatype,i=n["xml:lang"];return'"'+n.value+'"'+(r?"^^"+r:i?"@"+i:"");default:throw"unknown XML results type: "+n.prop("tagName")}return e[t]}))})},executeQuery:function(e,t){var n=t+"?query="+encodeURIComponent(e),r=new XMLHttpRequest;r.open("GET",n,!1),r.setRequestHeader("Accept","application/sparql-results+json"),r.send();var i,s=(i=JSON.parse(r.responseText)).head.vars;return i.results.bindings.map(e=>s.map(t=>{var n=e[t];switch(n.type){case"uri":return n.value;case"bnode":return"_:"+n.value;case"literal":var r=n.datatype,i=n["xml:lang"];return'"'+n.value+'"'+(r?"^^"+r:i?"@"+i:"");default:throw"unknown XML results type: "+n.prop("tagName")}return e[t]}))},makeN3DB:function(e,t){return{getNeighborhood:function(r,i){var s;t&&(s=new Date,t.start(!1,r,i));var a=e.getQuads(r,null,null,null).map(n.internalTriple);if(t){var o=new Date;t.end(a,o-s),s=o}t&&t.start(!0,r,i);var u=e.getQuads(null,null,r,null).map(n.internalTriple);return t&&t.end(u,new Date-s),{outgoing:a,incoming:u}},getSubjects:function(){return e.getSubjects().map(n.internalTerm)},getPredicates:function(){return e.getPredicates().map(n.internalTerm)},getObjects:function(){return e.getObjects().map(n.internalTerm)},getQuads:function(){return e.getQuads.apply(e,arguments).map(n.internalTriple)},get size(){return e.size}}},makeQueryDB:function(e,t){var n=this;function r(t,r,i){return n.executeQuery(t,e).map(e=>r?{subject:r,predicate:e[0],object:e[1]}:{subject:e[0],predicate:e[1],object:i})}return{getNeighborhood:function(e,i,s){var a,o,u,c,p=(o=s.expression,u=n.Visitor(),c={out:[],inc:[]},u.visitTripleConstraint=function(e){return c[e.inverse?"inc":"out"].push(e),e},o&&u.visitExpression(o),c),l=p.out.map(e=>e.predicate);l=l.filter((e,t)=>l.lastIndexOf(e)===t),t&&(a=new Date,t.start(!1,e,i));var f=p.out.length>0||s.closed?r(s.closed?`SELECT ?p ?o { <${e}> ?p ?o }`:"SELECT ?p ?o {\n"+l.map(t=>`  {<${e}> <${t}> ?o BIND(<${t}> AS ?p)}`).join(" UNION\n")+"\n}",e,null):[];if(t){var h=new Date;t.end(f,h-a),a=h}t&&t.start(!0,e,i);var d=p.inc.length>0?r(`SELECT ?s ?p { ?s ?p <${e}> }`,null,e):[];return t&&t.end(d,new Date-a),{outgoing:f,incoming:d}},getQuads:function(e,t,n,i){return r("SELECT "+[e?"":"?s",t?"":"?p",n?"":"?o","{",e||"?s",t||"?s",n||"?s","}"].join(" "),e,n)},getSubjects:function(){return["!Query DB can't index subjects"]},getPredicates:function(){return["!Query DB can't index predicates"]},getObjects:function(){return["!Query DB can't index objects"]},get size(){}}},NotSupplied:"-- not supplied --",UnknownIRI:"-- not found --",_expect:function(e,t,n){t in e||this._error("expected "+JSON.stringify(e)+" to have a ."+t),arguments.length>2&&e[t]!==n&&this._error("expected "+e[e]+" to equal ."+n)},_error:function(e){throw new Error(e)},unescapeText:function(e,t){try{return e=e.replace(/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\(.)/g,function(e,n,r,i){var s;if(n){if(s=parseInt(n,16),isNaN(s))throw new Error;return String.fromCharCode(s)}if(r){if(s=parseInt(r,16),isNaN(s))throw new Error;return s<65535?String.fromCharCode(s):String.fromCharCode(55296+((s-=65536)>>10),56320+(1023&s))}var a=t[i];if(!a)throw new Error("no replacement found for '"+i+"'");return a})}catch(e){return console.warn(e),""}}};function h(e){if("object"!=typeof e)return e;var t='"'+e.value+'"';return"language"in e?t+"@"+e.language:"type"in e?t+"^^"+e.type:t}function d(e,t){for(var n in f)t?e.prototype[n]=v(f[n]):e[n]=f[n];return e}function v(e){return function(t){return e(this,t)}}return d(d)}();void 0!==t&&void 0!==r&&(n.exports=i)},{"../lib/ShExWriter":8,"./RdfTerm":5,"hierarchy-closure":11}],7:[function(e,t,n){(function(r){var i=function(){var t=-1,n={term:"START"},i="VERBOSE"in r.env,s=e("./RdfTerm");function a(e){return s.isIRI(e)?e:s.isLiteral(e)?s.getLiteralValue(e):e.substr(2)}var o="http://www.w3.org/2001/XMLSchema#",u=[o+"integer",o+"nonPositiveInteger",o+"negativeInteger",o+"long",o+"int",o+"short",o+"byte",o+"nonNegativeInteger",o+"unsignedLong",o+"unsignedInt",o+"unsignedShort",o+"unsignedByte",o+"positiveInteger"],c=[o+"decimal"].concat(u),p=[o+"float",o+"double"].concat(c),l={};l[o+"integer"]=function(e,t){return e.match(/^[+-]?[0-9]+$/)||t("illegal integer value '"+e+"'"),parseInt(e)},l[o+"decimal"]=function(e,t){return e.match(/^[+-]?(?:[0-9]*\.[0-9]+|[0-9]+)$/)||t("illegal decimal value '"+e+"'"),parseFloat(e)};const f=/^[+\-]?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[eE][+\-]?[0-9]+)?$/;l[o+"float"]=function(e,t){return"NaN"===e?NaN:"INF"===e?1/0:"-INF"===e?-1/0:(e.match(f)||t("illegal float value '"+e+"'"),parseFloat(e))},l[o+"double"]=function(e,t){return"NaN"===e?NaN:"INF"===e?1/0:"-INF"===e?-1/0:(e.match(f)||t("illegal double value '"+e+"'"),Number(e))},testRange=function(e,t,n){var r={integer:{min:-1/0,max:1/0},decimal:{min:-1/0,max:1/0},float:{min:-1/0,max:1/0},double:{min:-1/0,max:1/0},nonPositiveInteger:{min:-1/0,max:0},negativeInteger:{min:-1/0,max:-1},long:{min:-0x8000000000000000,max:0x8000000000000000},int:{min:-2147483648,max:2147483647},short:{min:-32768,max:32767},byte:{min:-128,max:127},nonNegativeInteger:{min:0,max:1/0},unsignedLong:{min:0,max:0x10000000000000000},unsignedInt:{min:0,max:4294967295},unsignedShort:{min:0,max:65535},unsignedByte:{min:0,max:255},positiveInteger:{min:1,max:1/0}}[t.substr(o.length)];if(!r)throw Error("unexpected datatype: "+t);e<r.min?n('"'+e+'"^^<'+t+"> is less than the min:",r.min):e>r.max&&n('"'+e+'"^^<'+t+"> is greater than the max:",r.min)};var h={length:function(e,t){return e.length===t},minlength:function(e,t){return e.length>=t},maxlength:function(e,t){return e.length<=t}},d={mininclusive:function(e,t){return e>=t},minexclusive:function(e,t){return e>t},maxinclusive:function(e,t){return e<=t},maxexclusive:function(e,t){return e<t}},v={totaldigits:function(e,t){var n=e.match(/[0-9]/g);return n&&n.length<=t},fractiondigits:function(e,t){var n=e.match(/^[+-]?[0-9]*\.?([0-9]*)$/);return n&&n[1].length<=t}};function m(e){if('"'!==e[0])return e;var t={value:s.getLiteralValue(e)},n=s.getLiteralType(e);n&&"http://www.w3.org/2001/XMLSchema#string"!==n&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==n&&(t.type=n);var r=s.getLiteralLanguage(e);return r&&(t.language=r),t}function y(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}var g=function(){function e(e){return s.isLiteral(e)?-1!==["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#double"].indexOf(s.getLiteralType(e))?parseInt(s.getLiteralValue(e)):e:s.isBlank(e)?e:"<"+e+">"}return e(this.subject)+" "+e(this.predicate)+" "+e(this.object)+" ."};function x(e){return{byPredicate:e.reduce(function(e,t){var n=t.predicate;return n in e||(e[n]=[]),e[n].push(t),i&&(t.toString=g),e},{}),candidates:E(e.length).map(function(){return[]}),misses:[]}}function S(e,t){var[n,r]=[e,t].map(e=>s.isBlank(e)?1:s.isLiteral(e)?2:3);return n===r?e.localeCompare(t):n-r}function E(e){return 0===e?[]:Array(e).join(" ").split(/ /)}function b(e,t,n){t in e||O("expected "+JSON.stringify(e)+" to have a '"+t+"' attribute."),arguments.length>2&&e[t]!==n&&O("expected "+t+" attribute '"+e[t]+"' to equal '"+n+"'.")}function w(){}function O(){var e=Array.prototype.join.call(arguments,""),t=new Error(e);throw Error.captureStackTrace(t,O),t}return{construct:function r(c,f){if(!(this instanceof r))return new r(c,f);this.type="ShExValidator",f=f||{},this.options=f,this.options.or=this.options.or||"someOf",this.options.partition=this.options.partition||"exhaustive","noCache"in f&&f.noCache||(this.known={});var g=this;this.schema=c,this._expect=this.options.lax?w:b,this._optimize={},this.reset=function(){};var j=this.options.regexModule||e("../lib/regex/threaded-val-nerr");this.getAST=function(){return{type:"AST",shapes:Object.keys(this.schema.shapes).reduce(function(e,n){return e[n]={type:"ASTshape",expression:function(e,n,r){function i(){this.type="Epsilon"}function s(e){this.type="Choice",this.disjuncts=e}function a(e){this.type="EachOf",this.conjuncts=e}function o(e,t){this.type="SemActs",this.expression=e,this.semActs=t}return e?function e(r,u){var c,p;function l(e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=1),1===n&&1===r)return e;var o=r===t?new function(e){this.type="KleeneStar",this.expression=e}(e):E(r-n).reduce(function(t,n,r){return new s(0===r?[e,new i]:[new a([e,t]),new i])},void 0),u=0!==n?new a(E(n).map(function(t){return e}).concat(o)):o;return u}if("TripleConstraint"===r.type){var f="valueExprRef"in r?u.valueExprDefns[r.valueExprRef]:r.valueExpr,h=n.push(r)-1,d=new function(e,t,n,r,i){this.type="TripleConstraint",this.inverse=!!n,this.negated=!!r,this.predicate=t,void 0!==i&&(this.valueExpr=i)}(h,r.predicate,r.inverse,r.negated,f);return c=l(d,r.min,r.max),r.semActs?new o(c,r.semActs):c}if("OneOf"===r.type)return p=new s(r.expressions.map(function(t){return e(t,u)})),c=l(p,r.min,r.max),r.semActs?new o(c,r.semActs):c;if("EachOf"===r.type)return p=new a(r.expressions.map(function(t){return e(t,u)})),c=l(p,r.min,r.max),r.semActs?new o(c,r.semActs):c;if("Inclusion"===r.type){var v=u.shapes[r.include].expression;return e(v,u)}throw Error("unexpected expr type: "+r.type)}(e,r):new i}(g.schema.shapes[n].expression,[],g.schema)},e},{})}},this.indexTripleConstraints=function(e){var t=[];return e&&function e(n){"TripleConstraint"===n.type?t.push(n):"OneOf"===n.type||"EachOf"===n.type?n.expressions.forEach(function(t){e(t)}):"Inclusion"===n.type?e(c.productions[n.include]):O("unexpected expr type: "+n.type)}(e),t},this.emptyTracker=function(){var e=e=>e;return{recurse:e,known:e,enter:function(e,t){++this.depth},exit:function(e,t,n){--this.depth},depth:0}},this.validate=function(e,t,r,i,s){if("object"==typeof t){var a=t;if("api"===this.options.results)return a.map(t=>{var n=new Date,s=this.validate(e,t.node,t.shape,r,i);return n=new Date-n,{node:t.node,shape:t.shape,status:"errors"in s?"nonconformant":"conformant",appinfo:s,elapsed:n}});var o=a.reduce((t,n)=>{var r=this.validate(e,n.node,n.shape,i,s);return"errors"in r?{passes:t.passes,failures:t.failures.concat(r)}:{passes:t.passes.concat(r),failures:t.failures}},{passes:[],failures:[]});return o.failures.length?1!==o.failures.length?{type:"FailureList",errors:o.failures}:o.failures[0]:1!==o.passes.length?{type:"SolutionList",solutions:o.passes}:o.passes[0]}var u=void 0===i;i||(i=this.emptyTracker()),r&&r!==n||c.start||O("start production not defined");var p=null;r==n?p=c.start:"shapes"in this.schema&&0!==this.schema.shapes.length?r in this.schema.shapes?p=c.shapes[r]:O("shape "+r+" not found in:\n"+Object.keys(this.schema.shapes||[]).map(e=>"  "+e).join("\n")):O("shape "+r+" not found; no shapes in schema"),void 0===s&&(s={});var l=t+"@"+(r===n?"_: -start-":r);if(l in s)return i.recurse({type:"Recursion",node:m(t),shape:r});if("known"in this&&l in this.known)return i.known(this.known[l]);s[l]={point:t,shape:r},i.enter(t,r);var f=this._validateShapeExpr(e,t,p,r,i,s);return i.exit(t,r,f),delete s[l],"known"in this&&(this.known[l]=f),"startActs"in c&&u&&(f.startActs=c.startActs),f},this._validateShapeExpr=function(e,t,n,r,i,s){if(""===t)throw Error("validation needs a valid focus node");if("NodeConstraint"===n.type)return(a=this._errorsMatchingNodeConstraint(t,n,null)).length?{type:"Failure",node:m(t),shape:r,errors:a.map(function(e){return{type:"NodeConstraintViolation",shapeExpr:n,error:e}})}:{type:"NodeTest",node:m(t),shape:r,shapeExpr:n};if("Shape"===n.type)return this._validateShape(e,t,j.compile(c,n),n,r,i,s);if("ShapeRef"===n.type)return this._validateShapeExpr(e,t,c.shapes[n.reference],n.reference,i,s);if("ShapeExternal"===n.type)return this.options.validateExtern(e,t,r,i,s);if("ShapeOr"===n.type){for(var a=[],o=0;o<n.shapeExprs.length;++o){var u=n.shapeExprs[o];if(!("errors"in(l=this._validateShapeExpr(e,t,u,r,i,s))))return{type:"ShapeOrResults",solution:l};a.push(l)}return{type:"ShapeOrFailure",errors:a}}if("ShapeNot"===n.type)return"errors"in(l=this._validateShapeExpr(e,t,n.shapeExpr,r,i,s))?{type:"ShapeNotResults",solution:l}:{type:"ShapeNotFailure",errors:l};if("ShapeAnd"===n.type){var p=[];for(o=0;o<n.shapeExprs.length;++o){var l;if(u=n.shapeExprs[o],"errors"in(l=this._validateShapeExpr(e,t,u,r,i,s)))return{type:"ShapeAndFailure",errors:[l]};p.push(l)}return{type:"ShapeAndResults",solutions:p}}throw Error("expected one of Shape{Ref,And,Or} or NodeConstraint, got "+JSON.stringify(n))},this._validateShape=function(e,t,n,r,s,a,o){var u=this,p=null;if("startActs"in c&&!this.semActHandler.dispatchAll(c.startActs,null,{}))return{type:"Failure",node:m(t),shape:s,errors:["semact failure"]};for(var l=e.getNeighborhood(t,s,r),f=x(l.outgoing.sort((e,t)=>S(e.object,t.object))),h=x(l.incoming.sort((e,t)=>S(e.subject,t.subject))),d=l.outgoing.length,v=l.outgoing.concat(l.incoming),y=this.indexTripleConstraints(r.expression),g=y.reduce(function(t,n,r){n.inverse,n.inverse;var i=(n.inverse?h:f).byPredicate[n.predicate]||[],c=u._triplesMatchingShapeExpr(i,n.valueExpr,n.inverse,function(t,n){var r=u.validate(e,t,n,a,o);return"errors"in r?r.errors:[]},function(t,n){var r=u._validateShapeExpr(e,t,n,s,a,o);return"errors"in r?r.errors:[]});return c.hits.forEach(function(e){t.constraintList[v.indexOf(e)].push(r)}),c.misses.forEach(function(e){t.misses[v.indexOf(e.triple)]={constraintNo:r,errors:e.errors}}),t},{misses:{},constraintList:E(v.length).map(function(){return[]})}),b=[],w=g.constraintList.reduce(function(e,t,n){return 0===t.length&&n<d&&n in g.misses&&(void 0!==r.extra&&-1!==r.extra.indexOf(v[n].predicate)?b.push(n):e.push({tripleNo:n,constraintNo:g.misses[n].constraintNo,errors:g.misses[n].errors})),e},[]),O=function(e){var t=e.length,n=[],r=null;return{next:function(){if(null!==r&&0===r.length)return!1;if(null===r)return function(){r=[];for(var i=0;i<t;i++)n[i]=0,r[i]=e[i][0]}(),!0;var i=t-1;if(n[i]++,n[i]<e[i].length)return r[i]=e[i][n[i]],!0;for(;n[i]>=e[i].length;){if(0==i)return!1;n[i]=0,r[i]=e[i][0],n[--i]++}return r[i]=e[i][n[i]],!0},do:function(e,t){return e.apply(t,r)},get:function(){return r}}}(g.constraintList),j=[];0===w.length&&O.next()&&null===p;){var T=[],k=E(v.length).map(function(){return 0}),_=O.get();if(r.closed){var A=v.slice(0,d).filter((e,t)=>void 0===_[t]&&-1===b.indexOf(t));if(A.length>0){j.push({errors:[{type:"ClosedShapeViolation",unexpectedTriples:A}]});continue}}function N(){var e=y.length;return _.slice().reduce(function(e,t,n){return void 0!==t&&e[t].push(n),e},E(e).map(function(){return[]}))}function I(t,n){return u.validate(e,t,n,a,o)}function L(t,n){return u._validateShapeExpr(e,t,n,s,a,o)}function R(e,t,n,r){return u._errorsMatchingShapeExpr(e,t,n,r)}_.forEach(function(e,t){void 0!==e&&(T.push(v[t]),++k[e])}),_.slice().sort(function(e,t){return e-t}).filter(function(e){return void 0!==e}).map(function(e){return e+" "}).join("");var C=n.match(e,t,y,N(),_,v,I,L,this.semActHandler,R,null);if("errors"in C){if(j.push({errors:C.errors}),"exhaustive"!==u.options.partition)break}else{var V={type:"ShapeTest",node:m(t),shape:s};if(Object.keys(C).length>0&&(V.solution=C),"semActs"in r&&!this.semActHandler.dispatchAll(r.semActs,C,V)){if(j.push({errors:[{type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}]}),"exhaustive"!==u.options.partition)break}else p=V}}if(null===p){var B=w.map(function(e){var t=v[e.tripleNo];return{type:"TypeMismatch",triple:{type:"TestedTriple",subject:t.subject,predicate:t.predicate,object:m(t.object)},constraint:y[e.constraintNo],errors:e.errors}});p={type:"Failure",node:m(t),shape:s,errors:B.concat(1===j.length?j[0].errors:j)}}return i&&v.forEach(function(e){delete e.toString}),function(e){return"annotations"in r&&(e.annotations=r.annotations),e}(p)},this._triplesMatchingShapeExpr=function(e,t,n,r,i){var s=this,a=[],o=[];return e.forEach(function(e){var u=n?e.subject:e.object,c=void 0===t?[]:s._errorsMatchingShapeExpr(u,t,r,i);0===c.length?o.push(e):-1===o.indexOf(e)&&a.push({triple:e,errors:c})}),{hits:o,misses:a}},this._errorsMatchingShapeExpr=function(e,t,n,r){var i=this;if("NodeConstraint"===t.type)return this._errorsMatchingNodeConstraint(e,t,null);if("Shape"===t.type)return void 0===r?[]:r(e,t);if("ShapeRef"===t.type)return n?n(e,t.reference):[];if("ShapeOr"===t.type){for(var s=[],a=0;a<t.shapeExprs.length;++a){var o=i._errorsMatchingShapeExpr(e,t.shapeExprs[a],n,r);if(0===o.length)return o;s=s.concat(o)}return s}if("ShapeAnd"===t.type)return t.shapeExprs.reduce(function(t,s,a){return t.concat(i._errorsMatchingShapeExpr(e,s,n,r,!0))},[]);if("ShapeNot"===t.type)return(s=i._errorsMatchingShapeExpr(e,t.shapeExpr,n,r,!0)).length?[]:["Error validating "+e+" as "+JSON.stringify(t)+": expected NOT to pass"];throw Error("unknown value expression type '"+t.type+"'")},this._errorsMatchingNodeConstraint=function(e,t,n){var r=[],i=s.isLiteral(e)?s.getLiteralValue(e):s.isBlank(e)?e.substring(2):e,c=s.isLiteral(e)?s.getLiteralType(e):null,f=-1!==u.indexOf(c)?o+"integer":-1!==p.indexOf(c)?c:void 0;function g(){var n=Array.prototype.join.call(arguments,"");return r.push("Error validating "+e+" as "+JSON.stringify(t)+": "+n),!1}if("nodeKind"in t&&(-1===["iri","bnode","literal","nonliteral"].indexOf(t.nodeKind)&&g("unknown node kind '"+t.nodeKind+"'"),s.isBlank(e)?"iri"!==t.nodeKind&&"literal"!==t.nodeKind||g("blank node found when "+t.nodeKind+" expected"):s.isLiteral(e)?"literal"!==t.nodeKind&&g("literal found when "+t.nodeKind+" expected"):"bnode"!==t.nodeKind&&"literal"!==t.nodeKind||g("iri found when "+t.nodeKind+" expected")),t.datatype&&t.values&&g("found both datatype and values in "+tripleConstraint),t.datatype&&(s.isLiteral(e)?s.getLiteralType(e)!==t.datatype?g("mismatched datatype: "+s.getLiteralType(e)+" !== "+t.datatype):f?testRange(l[f](i,g),t.datatype,g):t.datatype===o+"boolean"?"true"!==i&&"false"!==i&&"1"!==i&&"0"!==i&&g("illegal boolean value: "+i):t.datatype===o+"dateTime"&&(i.match(/^[+-]?\d{4}-[01]\d-[0-3]\dT[0-5]\d:[0-5]\d:[0-5]\d(\.\d+)?([+-][0-2]\d:[0-5]\d|Z)?$/)||g("illegal dateTime value: "+i)):g("mismatched datatype: "+e+" is not a literal with datatype "+t.datatype)),t.values&&(s.isLiteral(e)&&t.values.reduce((t,n)=>{if(t)return!0;var r=m(e);return"Language"===n.type?n.languageTag===r.language:"object"==typeof n&&"value"in n&&n.value===r.value&&n.type===r.type&&n.language===r.language},!1)||-1!==t.values.indexOf(e)||t.values.some(function(t){if("object"==typeof t&&!("value"in t)){"type"in t||O("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var n=["Language","IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];function r(e,n,r){return s.isLiteral(e)?-1!==["LiteralStem","LiteralStemRange"].indexOf(t.type)?r(s.getLiteralValue(e),n):-1!==["LanguageStem","LanguageStemRange"].indexOf(t.type)?r(s.getLiteralLanguage(e)||null,n):g("literal "+e+" not comparable with non-literal "+n):-1===["IriStem","IriStemRange"].indexOf(t.type)?g("nonliteral "+e+" not comparable with literal "+JSON.stringify(n)):r(e,n)}function i(e,n){return r(e,n,(e,n)=>"LanguageStem"===t.type||"LanguageStemRange"===t.type?null!==e&&(e===n||""===n||"-"===e[n.length]):e.startsWith(n))}if(-1===n.indexOf(t.type)&&O("expected type attribute '"+t.type+"' to be in '"+n+"'."),y(t.stem)){if(!i(e,t.stem))return!1}else b(t.stem,"type","Wildcard");return!t.exclusions||!t.exclusions.some(function(t){if(y(t))return r(e,t,(e,t)=>e===t);"type"in t||O("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var n=["IriStem","LiteralStem","LanguageStem"];return-1===n.indexOf(t.type)&&O("expected type attribute '"+t.type+"' to be in '"+n+"'."),i(e,t.stem)})}})||g("value "+e+" not found in set "+JSON.stringify(t.values))),"pattern"in t){var x="flags"in t?new RegExp(t.pattern,t.flags):new RegExp(t.pattern);a(e).match(x)||g("value "+a(e)+" did not match pattern "+t.pattern)}return Object.keys(h).forEach(function(n){n in t&&!h[n](i,t[n])&&g("facet violation: expected "+n+" of "+t[n]+" but got "+e)}),Object.keys(d).forEach(function(n){n in t&&(f?d[n](l[f](i,g),t[n])||g("facet violation: expected "+n+" of "+t[n]+" but got "+e):g("facet violation: numeric facet "+n+" can't apply to "+e))}),Object.keys(v).forEach(function(n){n in t&&(f===o+"integer"||f===o+"decimal"?v[n](""+l[f](i,g),t[n])||g("facet violation: expected "+n+" of "+t[n]+" but got "+e):g("facet violation: numeric facet "+n+" can't apply to "+e))}),r},this.semActHandler={handlers:{},results:{},register:function(e,t){this.handlers[e]=t},dispatchAll:function(e,t,n){var r=this;return e.reduce(function(e,i){if(e&&i.name in r.handlers){var s="code"in i?i.code:g.options.semActs[i.name],a="extensions"in n&&i.name in n.extensions,o=a?n.extensions[i.name]:{};return e=e&&r.handlers[i.name].dispatch(s,t,o),!a&&Object.keys(o).length>0&&("extensions"in n||(n.extensions={}),n.extensions[i.name]=o),e}return e},!0)}}},start:n,options:{or:{oneOf:"exactly one disjunct must pass",someOf:"one or more disjuncts must pass",firstOf:"disjunct evaluation stops after one passes"},partition:{greedy:"each triple constraint consumes all triples matching predicate and object",exhaustive:"search all mappings of triples to triple constriant"}}}}();void 0!==e&&void 0!==n&&(t.exports=i)}).call(this,e("_process"))},{"../lib/regex/nfax-val-1err":9,"../lib/regex/threaded-val-nerr":10,"./RdfTerm":5,_process:2}],8:[function(e,t,n){var r=function(){var t=e("util"),n=-1,r=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,i=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,s={"\\":"\\\\",'"':'\\"',"/":"\\/","\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"},a={iri:"IRI",bnode:"BNODE",literal:"LITERAL",nonliteral:"NONLITERAL"};function o(e,t){if(!(this instanceof o))return new o(e,t);if(e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e)this._outputStream=e,this._endStream=void 0===t.end||!!t.end;else{var n="";this._outputStream={write:function(e,t,r){n+=e,r&&r()},end:function(e){e&&e(null,n)}},this._endStream=!0}this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),this._error=t.error||p,this.forceParens=!t.simplifyParentheses,this._expect=t.lax?f:l}function u(e){var t=s[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}function c(e){return e.replace(/\\/g,"\\\\").replace(/%/g,"\\%")}function p(e,t){"function"!=typeof e&&(t=e,e=p);var n=new Error(t);throw Error.captureStackTrace(n,e),n}function l(e,t,n){t in e||this._error(l,"expected "+e+" to have a ."+t),arguments.length>2&&e[t]!==n&&this._error(l,"expected "+e[e]+" to equal ."+n)}function f(){}return o.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeSchema:function(e,t){var n=this;this._expect(e,"type","Schema"),n.addPrefixes(e.prefixes),e.base&&n._write("BASE "+this._encodeIriOrBlankNode(e.base)+"\n"),e.imports&&e.imports.forEach(function(e){n._write("IMPORT "+n._encodeIriOrBlankNode(e)+"\n")}),e.startActs&&e.startActs.forEach(function(e){n._expect(e,"type","SemAct"),n._write(" %"+n._encodePredicate(e.name)+("code"in e?"{"+c(e.code)+"%}":"%"))}),e.start&&n._write("start = "+n._writeShapeExpr(e.start,t,!0,0).join("")+"\n"),"shapes"in e&&Object.keys(e.shapes).forEach(function(r){n._write(n._encodeShapeName(r,!1)+" "+n._writeShapeExpr(e.shapes[r],t,!0,0).join("")+"\n",t)})},_writeShapeExpr:function(e,n,r,i){var s=this,a=[];if("ShapeRef"===e.type)a.push("@",s._encodeShapeName(e.reference));else if("ShapeExternal"===e.type)a.push("EXTERNAL");else if("ShapeAnd"===e.type){i>=3&&a.push("(");var o=!1;e.shapeExprs.forEach(function(t,r){if(r>0){function i(t){let n=e.shapeExprs[t];return!("NodeConstraint"!==n.type||"nodeKind"in n&&"literal"===n.nodeKind||"datatype"in n||"values"in n)}let t=!o&&(i(r-1)&&function(t){let n=e.shapeExprs[t];return"Shape"===n.type||"ShapeRef"===n.type}(r)||(u=r-1,"Shape"===e.shapeExprs[u].type&&i(r)));t||a.push(" AND "),o=t}var u;a=a.concat(s._writeShapeExpr(t,n,!1,3))}),i>=3&&a.push(")")}else if("ShapeOr"===e.type)i>=2&&a.push("("),e.shapeExprs.forEach(function(e,t){t>0&&a.push(" OR "),a=a.concat(s._writeShapeExpr(e,n,r,2))}),i>=2&&a.push(")");else if("ShapeNot"===e.type)i>=4&&a.push("("),a.push("NOT "),a=a.concat(s._writeShapeExpr(e.shapeExpr,n,r,4)),i>=4&&a.push(")");else if("Shape"===e.type)a=a.concat(s._writeShape(e,n,r));else{if("NodeConstraint"!==e.type)throw Error("expected Shape{,And,Or,Ref} or NodeConstraint in "+t.inspect(e));a=a.concat(s._writeNodeConstraint(e,n,r))}return a},_writeShape:function(e,t,r){var i,s=this;try{var a=[];this._expect(e,"type","Shape"),e.closed&&a.push("CLOSED "),e.extra&&e.extra.length>0&&(a.push("EXTRA "),e.extra.forEach(function(e,t){a.push(s._encodeShapeName(e,!1)+" ")}),a.push(" "));function o(e,t){0===e&&1===t?a.push("?"):0===e&&t===n?a.push("*"):void 0===e&&void 0===t||(1===e&&t===n?a.push("+"):a.push("{",e,",",t===n?"*":t,"}"))}return a.push("{\n"),e.expression&&function e(n,r,i){function u(e){e&&e.forEach(function(e){s._expect(e,"type","SemAct"),a.push("\n"+r+"   %"),a.push(s._encodeValue(e.name)),"code"in e?a.push("{"+c(e.code)+"%}"):a.push("%")})}function p(t,n,s,o){var u=s<i||o;u&&a.push("("),t.forEach(function(i,o){e(i,r+"  ",s),o<t.length-1&&a.push(n)}),u&&a.push(")")}if("id"in n&&(a.push("$"),a.push(s._encodeIriOrBlankNode(n.id,!0))),"TripleConstraint"===n.type)n.inverse&&a.push("^"),n.negated&&a.push("!"),a.push(r,s._encodePredicate(n.predicate)," "),"valueExpr"in n?a=a.concat(s._writeShapeExpr(n.valueExpr,t,!0,0)):a.push(". "),o(n.min,n.max),s._annotations(a,n.annotations,r),u(n.semActs);else if("OneOf"===n.type){var l="id"in n||"min"in n||"max"in n||"annotations"in n||"semActs"in n;p(n.expressions,"\n"+r+"| ",1,l||s.forceParens),o(n.min,n.max),s._annotations(a,n.annotations,r),u(n.semActs)}else if("EachOf"===n.type)l="id"in n||"min"in n||"max"in n||"annotations"in n||"semActs"in n,p(n.expressions,";\n"+r,2,l||s.forceParens),o(n.min,n.max),s._annotations(a,n.annotations,r),u(n.semActs);else{if("Inclusion"!==n.type)throw Error("unexpected expr type: "+n.type);a.push("&"),a.push(s._encodeShapeName(n.include,!1))}}(e.expression,"  ",0),a.push("\n}"),(i=e.semActs)&&i.forEach(function(e){s._expect(e,"type","SemAct"),a.push(" %",s._encodePredicate(e.name),"code"in e?"{"+c(e.code)+"%}":"%")}),s._annotations(a,e.annotations,"  "),a}catch(e){t&&t(e)}},_writeNodeConstraint:function(e,t){try{this._expect(e,"type","NodeConstraint");var n=[];return e.nodeKind in a?n.push(a[e.nodeKind]," "):void 0!==e.nodeKind&&this._error("unexpected nodeKind: "+e.nodeKind),this._fillNodeConstraint(n,e,t),this._annotations(n,e.annotations,"  "),n}catch(e){t&&t(e)}},_annotations:function(e,t,n){var r=this;t&&t.forEach(function(t){r._expect(t,"type","Annotation"),e.push("//\n"+n+"   "),e.push(r._encodeValue(t.predicate)),e.push(" "),e.push(r._encodeValue(t.object))})},_fillNodeConstraint:function(e,t,n){var r=this;if(t.datatype&&t.values&&r._error("found both datatype and values in "+expr),t.datatype&&e.push(r._encodeShapeName(t.datatype)),t.values&&(e.push("["),t.values.forEach(function(t,n){if(n>0&&e.push(" "),o(t))e.push(r._encodeValue(t));else{"type"in t||runtimeError("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var s=["Language","IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];function a(e,t){return-1!==["LanguageStem","LanguageStemRange"].indexOf(e.type)?"@"+t:-1!==["LiteralStem","LiteralStemRange"].indexOf(e.type)?'"'+t.replace(i,t)+'"':r._encodeValue(t)}-1===s.indexOf(t.type)&&runtimeError("expected type attribute '"+t.type+"' to be in '"+s+"'."),"Language"===t.type?e.push("@"+t.languageTag):o(t.stem)?e.push(a(t,t.stem)+"~"):(l(t.stem,"type","Wildcard"),e.push(".")),t.exclusions&&t.exclusions.forEach(function(n){if(e.push(" - "),o(n))e.push(a(t,n));else{"type"in n||runtimeError("expected "+JSON.stringify(n)+" to have a 'type' attribute.");var r=["IriStem","LiteralStem","LanguageStem"];-1===r.indexOf(n.type)&&runtimeError("expected type attribute '"+n.type+"' to be in '"+r+"'."),e.push(a(t,n.stem)+"~")}})}}),e.push("]")),"pattern"in t){var s=t.pattern.replace(/\//g,"\\/"),a="flags"in t?t.flags:"";e.push("/"+s+"/"+a+" ")}return["length","minlength","maxlength","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits"].forEach(function(n){t[n]&&e.push(" ",n," ",t[n])}),e;function o(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}},_encodeIriOrBlankNode:function(e,t){if(t=t?" ":"","_"===e[0]&&":"===e[1])return e;r.test(e)&&(e=e.replace(i,u));var n=this._prefixRegex.exec(e);return n?(n[1]?this._prefixIRIs[n[1]]+n[2]:e)+t:"<"+e+">"},_encodeLiteral:function(e,t,n){return r.test(e)&&(e=e.replace(i,u)),n?'"'+e+'"@'+n:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeShapeName:function(e,t){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return this._encodeIriOrBlankNode(e,t)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e?"a":this._encodeIriOrBlankNode(e)},_encodeValue:function(e){return"object"!=typeof e?this._encodeIriOrBlankNode(e):this._encodeLiteral(e.value,e.type,e.language)},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},writeSchema:function(e,t){this._writeSchema(e,t),this.end(t)},addShape:function(e,t,n){this._write(_ShExWriter._encodeShapeName(t,!1)+" "+_ShExWriter._writeShapeExpr(e,n,!0,0).join(""),n)},addShapes:function(e){for(var t=0;t<e.length;t++)this.addShape(e[t])},addPrefix:function(e,t,n){var r={};r[e]=t,this.addPrefixes(r,n)},addPrefixes:function(e,t){var n=this._prefixIRIs,r=!1;for(var i in e){var s=e[i];n[s]!==(i+=":")&&(r=!0,n[s]=i,this._write("PREFIX "+i+" <"+s+">\n"))}if(r){var a="",o="";for(var u in n)a+=a?"|"+u:u,o+=(o?"|":"")+n[u];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+o+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(r?"\n":"",t)},_prefixRegex:/$0^/,end:function(e){this._write=this._blockedWrite;var t=e&&function(n,r){t=null,e(n,r)};if(this._endStream)try{return this._outputStream.end(t)}catch(e){}t&&t()}},o}();void 0!==e&&void 0!==n&&(t.exports=r)},{util:4}],9:[function(e,t,n){var r=function(){var t=e("../RdfTerm"),r="<span class='keyword' title='Split'>|</span>",i="<span class='keyword' title='Repeat'>×</span>",s="<span class='keyword' title='Match'>␃</span>",a=-1;function o(e){e||(e={});for(var t,n=1,r=arguments.length;n<r&&(t=arguments[n]||{});n++)for(var i in t)e[i]=t[i];return e}return n={name:"nfax-val-1err",description:"simple regular expression engine with n out states",compile:function(e,n){var u=n.expression;return function(){var t=[],n=f(s,[]),o=n;if(u){var p=function n(s,o){var u,c,l;function d(e,n){return void 0!=s.min&&1!==s.min||void 0!=s.max&&1!==s.max?(u=f(i,[e]),t[u].expr=s,t[u].min="min"in s?s.min:1,t[u].max="max"in s?s.max===a?1/0:s.max:1,h(n,u),{start:u,tail:[u]}):{start:e,tail:n}}if("TripleConstraint"===s.type)return u=f(s,[]),t[u].stack=o,{start:u,tail:[u]};if("OneOf"===s.type)return l=[],c=[],s.expressions.forEach(function(e,t){p=n(e,o.concat({c:s,e:t})),c.push(p.start),l=l.concat(p.tail)}),u=f(r,c),t[u].expr=s,d(u,l);if("EachOf"===s.type)return s.expressions.forEach(function(e,t){p=n(e,o.concat({c:s,e:t})),0===t?u=p.start:h(l,p.start),l=p.tail}),d(u,l);if("Inclusion"===s.type){var v=e.productions[s.include];return n(v,o)}throw Error("unexpected expr type: "+s.type)}(u,[]);h(p.tail,n),o=p.start}var l={algorithm:"rbenx",end:n,states:t,start:o,match:c};return n=t=o=null,l;function f(e,n,r){var i=t.length;return t.push({c:e,outs:n}),r&&(t[i].negated=!0),i}function h(e,n){e.forEach(e=>{t[e].outs.push(n)})}}();function c(n,r,i,s,u,c,d,v,m,y,g){var x=this,S=[],E=[];function b(e){return e.map(e=>{var t=x.states[e.state];return renderAtom(t.c,t.negated)})}if(1===x.states.length)return h([],0,c,d,v,m,y);var w=null;for(l(x,S,this.start,{repeats:{},avail:[],matched:[],stack:[],errors:[]});S.length;){E=[],g&&g.push({threads:[]});for(var O=0;O<S.length;++O){var j=S[O];if(j.state!==x.end){var T=x.states[j.state],k=E.length,_=i.indexOf(T.c),A="min"in T.c?T.c.min:1,N="max"in T.c?T.c.max===a?1/0:T.c.max:1;"negated"in T.c&&T.c.negated&&(A=N=0),void 0===j.avail[_]&&(j.avail[_]=s[_].slice());var I=j.avail[_].splice(0,N);if(I.length>=A)do{p(x,E,j,I)}while(j.avail[_].length>0&&I.length<N&&(I.push(j.avail[_].shift()),1));g&&g[g.length-1].threads.push({state:S[O].state,to:E.slice(k).map(e=>f(e.state,e.repeats))})}}if(0===E.length&&null===w)return C(b(x.states));var L=S;S=E,E=L;var R=S.reduce((e,t)=>{var n=t.matched.reduce((e,t)=>e+t.triples.length,0)===u.reduce((e,t)=>void 0===t?e:e+1,0);return null!==e?e:t.state===x.end&&n?t:null},null);R&&(w=R)}if(null===w)return C();function C(){return{type:"Failure",node:r,errors:b(x.states)}}function b(){return S.map(n=>{var r=o({},x.states[n.state].c.valueExpr);if("reference"in r){var i=r.reference;t.isBlank(i)&&(r.reference=e.shapes[i])}return o({type:T.c.negated?"NegatedProperty":n.state===x.end?"ExcessTripleViolation":"MissingProperty",property:T.c.predicate},Object.keys(r).length>0?{valueExpr:r}:{})})}return"errors"in w.matched?w.matched:h(w.matched,0,c,d,v,m,y)}function p(e,t,n,r){var s=e.states[n.state],a=e.states.map(e=>e.c===i?e.expr:null),o=s.stack.map(e=>{var t=n.repeats[a.indexOf(e.c)];return void 0===t?t=0:t-=1,{c:e.c,e:e.e,i:t}}),u={c:s.c,triples:r,stack:o};n.matched=n.matched.concat(u),s.outs.forEach(r=>{l(e,t,r,n)})}function l(e,t,n,s,a){a=a||[];var o=f(n,s.repeats);if(-1===a.indexOf(o)){a.push(o);var u=e.states[n];if(u.c===r)return u.outs.reduce((n,r,i)=>n.concat(l(e,t,r,s,a)),[]);if(u.c===i){var c=[];n in s.repeats||(s.repeats[n]=0);var p=s.repeats[n];return p<u.max&&(c=c.concat(l(e,t,u.outs[0],function(e,t){var n=Object.keys(e.repeats).reduce((n,r)=>(n[r]=parseInt(r)==t?e.repeats[r]+1:e.repeats[r],n),{});return{state:e.state,repeats:n,matched:e.matched,avail:e.avail.slice(),stack:e.stack}}(s,n),a))),p>=u.min&&p<=u.max&&(c=c.concat(l(e,t,u.outs[1],function(e,t){var n=Object.keys(e.repeats).reduce((n,r)=>(parseInt(r)!==t&&(n[r]=e.repeats[r]),n),{});return{state:e.state,repeats:n,matched:e.matched,avail:e.avail.slice(),stack:e.stack}}(s,n),a))),c}return[t.push({state:n,repeats:s.repeats,avail:s.avail.map(e=>e.slice()),stack:s.stack,matched:s.matched,errors:s.errors})-1]}}function f(e,t){var n=Object.keys(t).map(e=>e+":"+t[e]).join(",");return n.length?e+"-"+n:""+e}function h(e,r,i,s,a,o,u){var c=[],p=[],l=[],f=e.reduce((e,n)=>{for(var r,h=0,d=e;h<c.length&&n.stack[h].c===c[h].c&&n.stack[h].i===c[h].i&&n.stack[h].e===c[h].e;)d=d.solutions[c[h].i].expressions[c[h].e],++h;for(;h<n.stack.length;){if(h>=c.length&&c.push({}),n.stack[h].c!==c[h].c){if(r=[],d.type="EachOf"===n.stack[h].c.type?"EachOfSolutions":"OneOfSolutions",d.solutions=r,"min"in n.stack[h].c&&(d.min=n.stack[h].c.min),"max"in n.stack[h].c&&(d.max=n.stack[h].c.max),"annotations"in n.stack[h].c&&(d.annotations=n.stack[h].c.annotations),"semActs"in n.stack[h].c&&(d.semActs=n.stack[h].c.semActs),d=r,c[h].i=null,"semActs"in n.stack[h].c&&!o.dispatchAll(n.stack[h].c.semActs,"???",d))throw{type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]};f&&"semActs"in expr&&(f.semActs=expr.semActs)}else d=d.solutions;if(n.stack[h].i!==c[h].i?(r=[],d[n.stack[h].i]={type:"EachOf"===n.stack[h].c.type?"EachOfSolution":"OneOfSolution",expressions:r},d=r,c[h].e=null):d=d[c[h].i].expressions,n.stack[h].e===c[h].e)throw"how'd we get here?";r={},d[n.stack[h].e]=r,n.stack[h].e>0&&void 0===d[n.stack[h].e-1]&&-1===l.indexOf(d)&&l.push(d),d=r,c.length=h+1,++h}return d.type="TripleConstraintSolutions","min"in n.c&&(d.min=n.c.min),"max"in n.c&&(d.max=n.c.max),d.predicate=n.c.predicate,"valueExpr"in n.c&&(d.valueExpr=n.c.valueExpr),"productionLabel"in n.c&&(d.productionLabel=n.c.productionLabel),d.solutions=n.triples.map(e=>{var r=i[e],c={type:"TestedTriple",subject:r.subject,predicate:r.predicate,object:function(e){if('"'!==e[0])return e;var n={value:t.getLiteralValue(e)},r=t.getLiteralType(e);r&&"http://www.w3.org/2001/XMLSchema#string"!==r&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==r&&(n.type=r);var i=t.getLiteralLanguage(e);return i&&(n.language=i),n}(r.object)};function l(e,n,r){var i=r(e,n);if("errors"in i){var s={type:"ReferenceError",focus:e,shape:n,errors:i};return"string"==typeof shapeLabel&&t.isBlank(shapeLabel)&&(s.referencedShape=n),[s]}return("solution"in i&&0!==Object.keys(i.solution).length||"Recursion"===i.type)&&(c.referenced=i),[]}return"valueExpr"in d&&(p=p.concat(u(d.inverse?r.subject:r.object,d.valueExpr,function(e,t){return l(e,t,s)},function(e,t){return l(e,t,a)}))),0===p.length&&"semActs"in n.c&&!o.dispatchAll(n.c.semActs,r,c)&&p.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),c}),"annotations"in n.c&&(d.annotations=n.c.annotations),"semActs"in n.c&&(d.semActs=n.c.semActs),c=n.stack.slice(),e},{});return p.length?{type:"SemActFailure",errors:p}:(l.forEach(e=>{for(var t=0;t<e.length;++t)null!==e[t]&&void 0!==e[t]||e.splice(t--,1)}),"semActs"in n&&(f.semActs=n.semActs),f)}}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{"../RdfTerm":5}],10:[function(e,t,n){var r=function(){var t=e("../RdfTerm"),n=-1;function r(e){e||(e={});for(var t,n=1,r=arguments.length;n<r&&(t=arguments[n]||{});n++)for(var i in t)e[i]=t[i];return e}return{name:"threaded-val-nerr",description:"emulation of regular expression engine with error permutations",compile:function(e,i){var s=i.expression;return{match:function(a,o,u,c,p,l,f,h,d,v,m){if(!s)return{};var y=function i(s,a){var o=u.indexOf(s),p="min"in s?s.min:1,l="max"in s?s.max===n?1/0:s.max:1;function f(e,t){var n=0,i=[a],o={};("min"in s&&1!==s.min||"max"in s&&1!==s.max)&&(o.min=s.min,o.max=s.max),"semActs"in s&&(o.semActs=s.semActs),"annotations"in s&&(o.annotations=s.annotations);for(;n<l;++n){for(var u=[],c=0;c<i.length;++c){var f=i[c],h=t(f);if(h.length>0&&0===h[0].errors.length&&h.forEach(t=>{var n="expression"in f?f.expression.solutions:[];"solution"in t&&(n=n.concat(t.solution)),delete t.solution,t.expression=r({type:e,solutions:n},o)}),0===h.length||h[0].errors.length>0)return n<p?h:i;u=u.concat(h)}i=u}if(i.length>0&&0===i[0].errors.length&&"semActs"in s){var v=[],m=[];i.forEach(e=>{d.dispatchAll(s.semActs,"???",e)?v.push(e):(e.errors.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),m.push(e))}),i=v.length>0?v:m}return i}if("TripleConstraint"===s.type){var h="negated"in s&&s.negated||0===l;h&&(p=l=1/0),void 0===a.avail[o]&&(a.avail[o]=c[o].slice());var v={};("min"in s&&1!==s.min||"max"in s&&1!==s.max)&&(v.min=s.min,v.max=s.max),"semActs"in s&&(v.semActs=s.semActs),"annotations"in s&&(v.annotations=s.annotations);var m=a.avail[o].splice(0,p),y=h?0===m.length:m.length>=p,g=[],x=a.matched;if(y)do{g.push({avail:a.avail.map(e=>e.slice()),errors:a.errors.slice(),matched:x.concat({tNos:m.slice()}),expression:r({type:"TripleConstraintSolutions",predicate:s.predicate,solutions:m.map(e=>({type:"halfTestedTriple",tripleNo:e,constraintNo:o}))},"valueExpr"in s?{valueExpr:s.valueExpr}:{},"productionLabel"in s?{productionLabel:s.productionLabel}:{},v)})}while(a.avail[o].length>0&&m.length<l&&(m.push(a.avail[o].shift()),1));else{var S=r({},s.valueExpr);if("reference"in S){var E=S.reference;t.isBlank(E)&&(S.reference=e.shapes[E])}g.push({avail:a.avail,errors:a.errors.concat([r({type:h?"NegatedProperty":"MissingProperty",property:s.predicate},Object.keys(S).length>0?{valueExpr:S}:{})]),matched:x})}return g}if("OneOf"===s.type)return f("OneOfSolutions",e=>{var t=[],n=[];return s.expressions.forEach(r=>{var s={avail:e.avail.map(e=>e.slice()),errors:e.errors,matched:e.matched},a=i(r,s);0===a[0].errors.length?(t=t.concat(a),a.forEach(e=>{var t="solution"in s?s.solution.expressions:[];"expression"in e&&(t=t.concat([e.expression])),delete e.expression,e.solution={type:"OneOfSolution",expressions:t}})):n=n.concat(a)}),t.length>0?t:n});if("EachOf"===s.type)return f("EachOfSolutions",e=>s.expressions.reduce((e,t)=>e.reduce((e,n)=>{var r=i(t,n);return r.forEach(e=>{if(0===e.errors.length){var t="solution"in n?n.solution.expressions:[];"expression"in e&&(t=t.concat([e.expression])),delete e.expression,e.solution={type:"EachOfSolution",expressions:t}}}),e.concat(r)},[]),[e]));if("Inclusion"===s.type){var b=e.productions[s.include];return i(b,a)}runtimeError("unexpected expr type: "+s.type)}(s,{avail:[],matched:[],errors:[]}),g=y.reduce((e,t)=>{if(t.errors.length>0)return e;var n={};return Object.keys(p).forEach(e=>{void 0!==p[e]&&(n[e]=p[e])}),t.matched.forEach(e=>{e.tNos.forEach(e=>{delete n[e]})}),Object.keys(n).forEach(e=>{t.errors.push({type:"ExcessTripleViolation",triple:l[e],constraint:u[n[e]]})}),null!==e?e:Object.keys(n).length>0?null:t},null);return null!==g?function(e,n,r,s,a,o,u){return Object.keys(e).length>0&&function c(p){if("OneOfSolutions"===p.type||"EachOfSolutions"===p.type)p.solutions.forEach(e=>{e.expressions.forEach(e=>{c(e)})});else{if("TripleConstraintSolutions"!==p.type)throw Error("unexpected expr type in "+JSON.stringify(p));p.solutions=p.solutions.map(c=>{if("TestedTriple"===c.type)return c;var p=r[c.tripleNo],l=n[c.constraintNo],f={type:"TestedTriple",subject:p.subject,predicate:p.predicate,object:function(e){if('"'!==e[0])return e;var n={value:t.getLiteralValue(e)},r=t.getLiteralType(e);r&&"http://www.w3.org/2001/XMLSchema#string"!==r&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==r&&(n.type=r);var i=t.getLiteralLanguage(e);return i&&(n.language=i),n}(p.object)};function h(e,n,r){var s=r(e,n);if("errors"in s){var a={type:"ReferenceError",focus:e,shape:n};return"string"==typeof n&&t.isBlank(n)&&(a.referencedShape=i),a.errors=s,[a]}return("solution"in s&&0!==Object.keys(s.solution).length||"Recursion"===s.type)&&(f.referenced=s),[]}var d="valueExpr"in l?u(l.inverse?p.subject:p.object,l.valueExpr,function(e,t){return h(e,t,s)},function(e,t){return h(e,t,a)}):[];return 0===d.length&&"semActs"in l&&!o.dispatchAll(l.semActs,p,f)&&d.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),d.length>0&&(e.errors=e.errors||[],e.errors=e.errors.concat(d)),f})}}(e),"semActs"in i&&(e.semActs=i.semActs),e}(g.expression,u,l,f,h,d,v):y.length>1?{type:"PossibleErrors",errors:y.reduce((e,t)=>e.concat([t.errors]),[])}:y[0]}}}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{"../RdfTerm":5}],11:[function(e,t,n){var r=function(){return{create:function(){let e={},t={},n={},r={};return{add:function(i,s){if(i in n&&-1!==n[i].indexOf(s))return;let a=i in r?c(i):e[i]=c(i),o=c(s);function u(e,t,n,r){e[r]=e[r].concat(n,e[n]),e[n].forEach(e=>t[e]=t[e].concat(r,t[r]))}function c(e){return e in r||(t[e]=[],n[e]=[],r[e]={}),r[e]}a[s]=o,s in e&&delete e[s],u(n,t,s,i),u(t,n,i,s)},roots:e,parents:t,children:n}},walk:function e(t,n,r){return Object.keys(t).reduce((i,s)=>i.concat(e(t[s],n,s),r?n(s,r):[]),[])}}}();void 0!==e&&void 0!==n&&(t.exports=r)},{}],12:[function(e,t,n){var r={RdfTerm:e("./lib/RdfTerm"),Util:e("./lib/ShExUtil"),Validator:e("./lib/ShExValidator"),Writer:e("./lib/ShExWriter"),"nfax-val-1err":e("./lib/regex/nfax-val-1err"),"threaded-val-nerr":e("./lib/regex/threaded-val-nerr")};void 0!==e&&void 0!==n&&(t.exports=r)},{"./lib/RdfTerm":5,"./lib/ShExUtil":6,"./lib/ShExValidator":7,"./lib/ShExWriter":8,"./lib/regex/nfax-val-1err":9,"./lib/regex/threaded-val-nerr":10}]},{},[12])(12)});